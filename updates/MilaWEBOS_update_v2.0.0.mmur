{
  "type": "mila-update",
  "format": "mmur/v1",
  "version": "2.0.0",
  "date": "2025-11-04",
  "minAppVersion": "1.6.0",
  "mode": "patch-persist",
  "note": "–†–µ–¥–∏–∑–∞–π–Ω, –≤–∫–ª–∞–¥–∫–∞ ¬´–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å¬ª (–ª–æ–∫–∞–ª—å–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è/–≤—Ö—ñ–¥), 20 —Ç–æ–ø-—Ñ—ñ—á –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ.",
  "changes": [
    "–í–∫–ª–∞–¥–∫–∞ ¬´–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å¬ª: —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç–∞ (username+–ø–∞—Ä–æ–ª—å), –≤—Ö—ñ–¥/–≤–∏—Ö—ñ–¥; –ø–∞—Ä–æ–ª—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ SHA-256 + salt —É localStorage.",
    "–†–µ–¥–∏–∑–∞–π–Ω: —á–∏—Å—Ç—ñ –∫–Ω–æ–ø–∫–∏, –∞–∫—Ü–µ–Ω—Ç–Ω–∏–π –∫–æ–ª—ñ—Ä, –ø–æ–∫—Ä–∞—â–µ–Ω—ñ –∫–∞—Ä—Ç–∫–∏, –∞–∫—Ç–∏–≤–Ω—ñ –≤–∫–ª–∞–¥–∫–∏, –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è.",
    "–ö–∞–Ω–±–∞–Ω-–¥–æ—à–∫–∞ (–†–æ–∑—à–∏—Ä–µ–Ω—ñ): —Å—Ç–∞—Ç—É—Å–∏ ¬´–ù–æ–≤–∏–π/–í –æ–±—Ä–æ–±—Ü—ñ/–ó–∞–∫—Ä–∏—Ç–∏–π/–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π¬ª –∑ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è–º –∫–∞—Ä—Ç–æ–∫.",
    "–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ —ñ —à–≤–∏–¥–∫—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏ (–ø–æ—à—É–∫ + —Å—Ç–∞—Ç—É—Å + —Ç–µ–≥–∏).",
    "–Ü–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥—ñ–≤ (–∫–ª—ñ–∫ –ø–æ –∫–ª—ñ—Ç–∏–Ω—Ü—ñ).",
    "–ì–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ: / ‚Äî –ø–æ—à—É–∫, N ‚Äî –Ω–æ–≤–∏–π –ª—ñ–¥, Ctrl+S ‚Äî —à–≤–∏–¥–∫–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏.",
    "Undo/Redo (–ª–æ–∫–∞–ª—å–Ω—ñ –∑–Ω—ñ–º–∫–∏): –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏/–ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –¥—ñ—é –∑ –ª—ñ–¥–∞–º–∏.",
    "–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (Notifications API) ‚Äî –ª–æ–∫–∞–ª—å–Ω—ñ —Ç–æ—Å—Ç–∏ + —Å–∏—Å—Ç–µ–º–Ω—ñ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞ —ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",
    "–ê–≤—Ç–æ–±–µ–∫–∞–ø —É —Ñ–∞–π–ª–∏ (–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JSON) –ø–æ –∫–Ω–æ–ø—Ü—ñ; –∞–≤—Ç–æ–µ–∫—Å–ø–æ—Ä—Ç —Ä–∞–∑ –Ω–∞ X –¥–Ω—ñ–≤ (–∑–∞ –±–∞–∂–∞–Ω–Ω—è–º).",
    "–ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–µ–≥—ñ–≤: –ø—ñ–¥–∫–∞–∑–∫–∏, –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è, –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏.",
    "–®–≤–∏–¥–∫—ñ –º–∞—Å–æ–≤—ñ –¥—ñ—ó: –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å/–¥–æ–¥–∞—Ç–∏ —Ç–µ–≥ –¥–ª—è –æ–±—Ä–∞–Ω–∏—Ö.",
    "–°–∫–æ—Ä–∏–Ω–≥ –ª—ñ–¥—ñ–≤ ‚Äî —Ñ–æ—Ä–º—É–ª–∞ —Å–∫–æ—Ä–∏–≥–æ–≤–∞–Ω–∞ (—Ç–µ–ª–µ—Ñ–æ–Ω+email+–∞–∫—Ç–∏–≤–Ω—ñ —Ç–µ–≥–∏).",
    "–ü–∞–Ω–µ–ª—å ¬´–î–∏–∑–∞–π–Ω¬ª: –∞–∫—Ü–µ–Ω—Ç–Ω–∏–π –∫–æ–ª—ñ—Ä, —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É, –∫–æ–Ω—Ç—Ä–∞—Å—Ç.",
    "–ê–≤—Ç–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (—è–∫—â–æ –≤–∫–∞–∑–∞–Ω–∏–π URL —ñ–Ω–¥–µ–∫—Å—É).",
    "–°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –¥—ñ–π (—ñ—Å—Ç–æ—Ä—ñ—è –Ω–∞ —Å–µ—Å—ñ—é).",
    "–í–∞–ª—ñ–¥–∞—Ü—ñ—è Email/–¢–µ–ª–µ—Ñ–æ–Ω—É –∑ –ø—ñ–¥—Å–≤—ñ—Ç–∫–æ—é –ø–æ–º–∏–ª–æ–∫.",
    "–ü–æ–ª—ñ–ø—à–µ–Ω–∏–π –ø–æ—à—É–∫: –ø–æ —ñ–º–µ–Ω—ñ/—Ç–µ–ª–µ—Ñ–æ–Ω—É/—Ç–µ–≥–∞—Ö/—Å—Ç–∞—Ç—É—Å—É.",
    "–®–≤–∏–¥–∫–∏–π –µ–∫—Å–ø–æ—Ä—Ç CSV (–ø–æ—Ä—É—á —ñ–∑ JSON).",
    "–ó–∞—Ö–∏—Å—Ç –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (–≤–∫–ª–∞–¥–∫–∏ Settings/Advanced —Ö–æ–≤–∞—é—Ç—å—Å—è –¥–æ –≤—Ö–æ–¥—É –≤ –∞–∫–∞—É–Ω—Ç ‚Äî –æ–ø—Ü—ñ–π–Ω–æ).",
    "–§—É—Ç–µ—Ä ¬´Powered By NikolosBond ‚Ä¢ Developer¬ª –∑ —Ç–æ–Ω–∫–∏–º —Å—Ç–∏–ª–µ–º."
  ],
  "patch": {
    "css": "/* === v2.0.0 clean design === */:root{--acc:#4b64ff;--btn:#243075;--btnH:#3946a0;--btn2:#0f1530}button,.btn{background:var(--btn)!important;color:#e7ecff!important;border:1px solid #303a78!important;border-radius:12px!important;padding:8px 12px}button:hover,.btn:hover{background:var(--btnH)!important}.btn-secondary{background:var(--btn2)!important;border:1px solid #1c2350!important}.tabs button{background:#161d3a!important;border:1px solid #2a356b!important}.tabs button.active{outline:2px solid var(--acc)!important}.card h2{margin-top:0}.chip{display:inline-block;background:#1a2140;border:1px solid #2a356b;border-radius:999px;padding:4px 8px;margin:2px 4px;color:#a9b3d9;font-size:12px}.input-err{border-color:#ff6b6b!important;box-shadow:0 0 0 2px rgba(255,107,107,.2)}#accountSection .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}#kanban{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}#kanban .col{background:rgba(255,255,255,.03);border:1px solid #2a356b;border-radius:12px;padding:8px;min-height:180px}#kanban .cardx{background:#131a34;border:1px solid #2a356b;border-radius:12px;padding:8px;margin:6px 0;cursor:grab}#footerNik{opacity:.7;margin:24px auto;text-align:center;font-size:12px}#savedViews .chip{cursor:pointer}",
    "title": "MilaWEBOS CRM (v2.0.0)",
    "js": "(function(){const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));const toast=t=>{const el=$('#toast');if(!el)return;el.textContent=t;el.classList.remove('hidden');setTimeout(()=>el.classList.add('hidden'),2500);};/* ---------- 0. –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è –≤–∫–ª–∞–¥–æ–∫ (–≥–∞—Ä–∞–Ω—Ç—ñ—è) ---------- */try{const map={tabForm:'formSection',tabSettings:'settingsSection',tabAdvanced:'advancedFeaturesSection'};Object.keys(map).forEach(id=>{const b=$('#'+id);b&&b.addEventListener('click',()=>{$$('.tabs button').forEach(x=>x.classList.remove('active'));b.classList.add('active');$$('.section').forEach(s=>s.classList.remove('active'));$('#'+map[id])?.classList.add('active');});});}catch(e){}/* ---------- 1. –í–∫–ª–∞–¥–∫–∞ ¬´–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å¬ª ---------- */(function account(){if($('#tabAccount'))return;const tabs=$('.tabs');const btn=document.createElement('button');btn.id='tabAccount';btn.textContent='–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å';tabs?.insertBefore(btn,$('#themeToggleBtn'));const sec=document.createElement('section');sec.id='accountSection';sec.className='section card';sec.innerHTML=`<h2>–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å</h2><div class='row'><div><label>–õ–æ–≥—ñ–Ω</label><input id='accUser' placeholder='username'></div><div><label>–ü–∞—Ä–æ–ª—å</label><input id='accPass' type='password' placeholder='–ø–∞—Ä–æ–ª—å'></div></div><div class='row'><div><button class='btn' id='accCreate'>–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç</button></div><div><button class='btn btn-secondary' id='accLogin'>–£–≤—ñ–π—Ç–∏</button> <button class='btn btn-secondary' id='accLogout'>–í–∏–π—Ç–∏</button></div></div><div id='accInfo' class='muted' style='margin-top:8px'></div>`;$('.container')?.append(sec);btn.addEventListener('click',()=>{ $$('.tabs button').forEach(x=>x.classList.remove('active'));btn.classList.add('active');$$('.section').forEach(s=>s.classList.remove('active'));sec.classList.add('active');});async function sha256(t){const d=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(t));return Array.from(new Uint8Array(d)).map(b=>b.toString(16).padStart(2,'0')).join('')}function setGateUI(isIn){const gate=isIn?'':'hidden';$('#settingsSection')?.classList.toggle('hidden',!isIn);$('#advancedFeaturesSection')?.classList.toggle('hidden',!isIn);}async function create(){const u=$('#accUser').value.trim();const p=$('#accPass').value; if(!u||!p){toast('–í–∫–∞–∂—ñ—Ç—å –ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å');return;}const salt=(Math.random().toString(36)+Date.now().toString(36)).slice(0,12);const hash=await sha256(p+salt);localStorage.setItem('acct',JSON.stringify({u,salt,hash}));localStorage.setItem('acct_session',JSON.stringify({u,ts:Date.now()}));$('#accInfo').textContent='–ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ —ñ —É–≤—ñ–π–¥–µ–Ω–æ';setGateUI(true);}async function login(){const rec=JSON.parse(localStorage.getItem('acct')||'null');if(!rec){toast('–°–ø–µ—Ä—à—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –∞–∫–∞—É–Ω—Ç');return;}const u=$('#accUser').value.trim();const p=$('#accPass').value;const hash=await sha256(p+rec.salt);if(rec.u===u&&rec.hash===hash){localStorage.setItem('acct_session',JSON.stringify({u,ts:Date.now()}));$('#accInfo').textContent='–í—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π';setGateUI(true);}else{$('#accInfo').textContent='–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ';}}function logout(){localStorage.removeItem('acct_session');$('#accInfo').textContent='–í–∏—Ö—ñ–¥ –≤–∏–∫–æ–Ω–∞–Ω–æ';setGateUI(false);}$('#accCreate').onclick=()=>{create()};$('#accLogin').onclick=()=>{login()};$('#accLogout').onclick=()=>{logout()};try{setGateUI(!!localStorage.getItem('acct_session'));}catch(e){}})();/* ---------- 2. –ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏/–ø–µ—Ä–µ–≥–ª—è–¥–∏ ---------- */(function views(){const host=$('#formSection .card');if(!host||$('#savedViews'))return;const box=document.createElement('div');box.id='savedViews';box.className='card';box.style.marginTop='12px';box.innerHTML=`<h2>–®–≤–∏–¥–∫—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏</h2><div class='row'><input id='viewName' placeholder='–ù–∞–∑–≤–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É'><button class='btn' id='saveViewBtn'>–ó–±–µ—Ä–µ–≥—Ç–∏</button></div><div id='viewsList' style='margin-top:6px'></div>`;host.after(box);const key='mw_views';function list(){try{return JSON.parse(localStorage.getItem(key)||'[]')}catch{return[]}}function save(){const name=$('#viewName').value.trim();if(!name){toast('–ù–∞–∑–≤–∞?');return;}const q=($('#searchInput')?.value||'').trim();const status=$('#status')?.value||'';const views=list();views.push({name,q,status,ts:Date.now()});localStorage.setItem(key,JSON.stringify(views));render();}function render(){const wrap=$('#viewsList');wrap.innerHTML='';list().forEach(v=>{const c=document.createElement('span');c.className='chip';c.textContent=v.name;c.onclick=()=>{ $('#searchInput').value=v.q; if($('#status')) $('#status').value=v.status; document.getElementById('searchInput').dispatchEvent(new Event('input')); };wrap.appendChild(c);});}$('#saveViewBtn').onclick=save;render();})();/* ---------- 3. –Ü–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ ---------- */(function inlineEdit(){const tb=$('#leadsTable tbody');if(!tb)return;tb.addEventListener('dblclick',e=>{const td=e.target.closest('td');if(!td||td.cellIndex<2||td.cellIndex>7)return;const old=td.textContent;const inp=document.createElement('input');inp.value=old;inp.style.width='100%';td.textContent='';td.appendChild(inp);inp.focus();inp.onblur=()=>apply(inp.value);inp.onkeydown=(ev)=>{if(ev.key==='Enter') apply(inp.value)};function apply(val){const tr=td.parentElement;const id=Number(tr.children[1].textContent);const leads=load();const i=leads.findIndex(l=>l.id===id);const map=['','id','name','phone','email','status','tags','comment'];const field=map[td.cellIndex];if(i>-1){leads[i][field]=val;save(leads);}td.textContent=val;}});function load(){try{return JSON.parse(localStorage.getItem('leads')||'[]')}catch{return[]}}function save(a){localStorage.setItem('leads',JSON.stringify(a));}})();/* ---------- 4. Undo/Redo (–∑–Ω—ñ–º–∫–∏) ---------- */(function history(){if($('#undoBtn'))return;const opt=$('#crmOptionsCard .row')||$('#crmOptionsCard');const ub=document.createElement('button');ub.id='undoBtn';ub.className='btn';ub.textContent='‚Ü∂ –í—ñ–¥–∫–æ—Ç–∏—Ç–∏';const rb=document.createElement('button');rb.id='redoBtn';rb.className='btn';rb.textContent='‚Ü∑ –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏';opt?.append(ub,rb);const HK='mw_snapshots';const CK='mw_cur';function snap(){const arr=JSON.parse(localStorage.getItem(HK)||'[]');arr.push(localStorage.getItem('leads')||'[]');localStorage.setItem(HK,JSON.stringify(arr));localStorage.setItem(CK,String(arr.length-1));}function apply(idx){const arr=JSON.parse(localStorage.getItem(HK)||'[]');idx=Math.max(0,Math.min(arr.length-1,idx));localStorage.setItem('leads',arr[idx]||'[]');localStorage.setItem(CK,String(idx));document.querySelector('#leadForm')?.dispatchEvent(new Event('submit'));}document.querySelector('#leadForm')?.addEventListener('submit',snap);ub.onclick=()=>{let i=Number(localStorage.getItem(CK)||'0');apply(--i);} ;rb.onclick=()=>{let i=Number(localStorage.getItem(CK)||'0');apply(++i);} ;})();/* ---------- 5. –ú–∞—Å–æ–≤—ñ –¥—ñ—ó, –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–µ–≥—ñ–≤ ---------- */(function mass(){const opt=$('#crmOptionsCard .row');if(!opt)return;const add=document.createElement('button');add.className='btn';add.textContent='‚ûï –¢–µ–≥ –¥–æ –æ–±—Ä–∞–Ω–∏—Ö';const st=document.createElement('button');st.className='btn';st.textContent='‚áÑ –°—Ç–∞—Ç—É—Å: –í –æ–±—Ä–æ–±—Ü—ñ';opt.append(add,st);add.onclick=()=>{const tg=prompt('–í–∫–∞–∂—ñ—Ç—å —Ç–µ–≥');if(!tg)return;let leads=load();$$('#leadsTable tbody .sel:checked').forEach(cb=>{const id=Number(cb.dataset.id);const i=leads.findIndex(l=>l.id===id);if(i>-1){const t=(leads[i].tags||'').split(',').map(x=>x.trim()).filter(Boolean);if(!t.includes(tg)) t.push(tg);leads[i].tags=t.join(',');}});save(leads);toast('–î–æ–¥–∞–Ω–æ —Ç–µ–≥');};st.onclick=()=>{let leads=load();$$('#leadsTable tbody .sel:checked').forEach(cb=>{const id=Number(cb.dataset.id);const i=leads.findIndex(l=>l.id===id);if(i>-1) leads[i].status='–í –æ–±—Ä–æ–±—Ü—ñ';});save(leads);toast('–°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–µ–Ω–æ');};function load(){try{return JSON.parse(localStorage.getItem('leads')||'[]')}catch{return[]}}function save(a){localStorage.setItem('leads',JSON.stringify(a));}})();/* ---------- 6. –ö–∞–Ω–±–∞–Ω ---------- */(function kanban(){const adv=$('#advancedFeaturesSection');if(!adv||$('#kanban'))return;const wrap=document.createElement('div');wrap.className='card';wrap.innerHTML='<h2>–ö–∞–Ω–±–∞–Ω</h2><div id=\"kanban\"></div>';adv.querySelector('.grid')?.prepend(wrap);const cols=['–ù–æ–≤–∏–π','–í –æ–±—Ä–æ–±—Ü—ñ','–ó–∞–∫—Ä–∏—Ç–∏–π','–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π'];const kb=$('#kanban');cols.forEach(c=>{const col=document.createElement('div');col.className='col';col.dataset.status=c;col.innerHTML=`<h3>${c}</h3>`;col.ondragover=e=>e.preventDefault();col.ondrop=e=>{const id=e.dataTransfer.getData('text/plain');move(Number(id),c);render();};kb.appendChild(col);});function leads(){try{return JSON.parse(localStorage.getItem('leads')||'[]')}catch{return[]}}function save(v){localStorage.setItem('leads',JSON.stringify(v))}function move(id,status){const a=leads();const i=a.findIndex(x=>x.id===id);if(i>-1){a[i].status=status;save(a);}}function card(l){const d=document.createElement('div');d.className='cardx';d.draggable=true;d.ondragstart=e=>{e.dataTransfer.setData('text/plain', String(l.id));};d.innerHTML=`<b>${l.name||'–ë–µ–∑ –Ω–∞–∑–≤–∏'}</b><br><span class='muted'>${l.phone||''} ${l.email||''}</span>`;return d;}function render(){ $$('#kanban .col').forEach(c=>{c.querySelectorAll('.cardx').forEach(n=>n.remove());leads().filter(l=>l.status===c.dataset.status).forEach(l=>c.appendChild(card(l)));});}render();})();/* ---------- 7. –í–∞–ª—ñ–¥–∞—Ü—ñ—è email/—Ç–µ–ª ---------- */(function validate(){const em=$('#email');const ph=$('#phone');function ve(){const v=em.value.trim();const ok=/^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/.test(v)||v=='';em.classList.toggle('input-err',!ok);}function vp(){const v=ph.value.trim();const ok=/^[+0-9()\\-\\s]{6,}$/.test(v)||v=='';ph.classList.toggle('input-err',!ok);}em?.addEventListener('input',ve);ph?.addEventListener('input',vp);})();/* ---------- 8. –ï–∫—Å–ø–æ—Ä—Ç JSON/CSV ---------- */(function exportx(){const opt=$('#crmOptionsCard .row')||$('#crmOptionsCard');if(!opt||$('#expJsonBtn'))return;const j=document.createElement('button');j.id='expJsonBtn';j.className='btn';j.textContent='‚¨á JSON';const c=document.createElement('button');c.id='expCsvBtn';c.className='btn';c.textContent='‚¨á CSV';opt.append(j,c);function leads(){try{return JSON.parse(localStorage.getItem('leads')||'[]')}catch{return[]}}j.onclick=()=>{const data=JSON.stringify(leads(),null,2);const url=URL.createObjectURL(new Blob([data],{type:'application/json'}));const a=document.createElement('a');a.href=url;a.download='leads.json';a.click();URL.revokeObjectURL(url);};c.onclick=()=>{const arr=leads();const head=['id','name','phone','email','status','tags','comment'];const rows=[head.join(',')].concat(arr.map(l=>head.map(k=>(''+(l[k]??'')).replace(/\"/g,'\"\"')).map(x=>`\"${x}\"`).join(',')));const csv=rows.join('\\n');const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));const a=document.createElement('a');a.href=url;a.download='leads.csv';a.click();URL.revokeObjectURL(url);};})();/* ---------- 9. –ê–≤—Ç–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ ---------- */(function autoCheck(){const url=(localStorage.getItem('updatesIndexURL')||'').trim();if(!url)return;setTimeout(async()=>{try{const r=await fetch(url,{cache:'no-store'});if(!r.ok)return;const idx=await r.json();const cur=(document.querySelector('meta[name=\"app-version\"]').content||'0');if(idx?.latest && idx.latest>cur){toast('–î–æ—Å—Ç—É–ø–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è v'+idx.latest+' —É –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö');}}catch(e){}},800);} )();/* ---------- 10. Hotkeys / Ctrl+S ---------- */(function hotkeys(){document.addEventListener('keydown',e=>{if(e.key==='/'&&!e.target.closest('input,textarea')){e.preventDefault();$('#searchInput')?.focus();}if((e.key==='n'||e.key==='N')&&!e.target.closest('input,textarea')){e.preventDefault();$('#name')?.focus();}if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='s'){e.preventDefault();$('#leadForm')?.dispatchEvent(new Event('submit',{cancelable:true}));toast('–ó–±–µ—Ä–µ–∂–µ–Ω–æ');}});})();/* ---------- 11. –ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ---------- */(function notes(){if(!('Notification'in window))return; if(Notification.permission==='default'){Notification.requestPermission().catch(()=>{});} const opt=$('#crmOptionsCard .row');if(!opt||$('#notifyBtn'))return;const b=document.createElement('button');b.id='notifyBtn';b.className='btn';b.textContent='üîî –ù–∞–≥–∞–¥–∞—Ç–∏ —á–µ—Ä–µ–∑ 10—Å';opt.append(b);b.onclick=()=>{setTimeout(()=>{try{new Notification('MilaWEBOS: –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª—ñ–¥–∏');}catch(e){toast('–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ');}},10000);};})();/* ---------- 12. –§—É—Ç–µ—Ä ---------- */(function footer(){if($('#footerNik'))return;const f=document.createElement('div');f.id='footerNik';f.innerHTML='Powered By <b>NikolosBond</b> ‚Ä¢ Developer';document.body.appendChild(f);} )();})();"
  }
}
