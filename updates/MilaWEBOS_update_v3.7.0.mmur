{
  "type": "mila-update",
  "format": "mmur/v1",
  "version": "3.7.0",
  "date": "2025-11-04",
  "minAppVersion": "3.3.0",
  "mode": "patch-persist",
  "note": "ÐÐ°Ð²Ñ‡Ð°Ð½Ð½Ñ Ð¿ÐµÑ€ÐµÐºÑ€Ð¸Ð²Ð°Ñ” UI Ð¹ ÑÐ°Ð¼Ðµ Ð·Ð°ÐºÑ€Ð¸Ð²Ð°Ñ” Ð¿Ð°Ð½ÐµÐ»Ñ–; AI-Ð¿Ð¾Ð¼Ñ–Ñ‡Ð½Ð¸Ðº Ð´Ð¾Ð¿Ñ€Ð°Ñ†ÑŒÐ¾Ð²Ð°Ð½Ð¸Ð¹ (Ð¿ÐµÑ€ÐµÑÑƒÐ²Ð½Ð¸Ð¹, Ð´Ñ–Ñ—); Ð¿Ð¾Ð²Ð½Ð¸Ð¹ i18n UA/EN; ÐºÐ¾ÑˆÐ¸Ðº-Ñ–ÐºÐ¾Ð½ÐºÐ°; Ð±Ð¾ÐºÐ¾Ð²Ðµ Ð¼ÐµÐ½ÑŽ; NeonGlass Ñ‚ÐµÐ¼Ð°; 20 Ñ„Ñ–Ñ‡ Ñ– Ð¾Ð¿Ñ‚Ð¸Ð¼Ñ–Ð·Ð°Ñ†Ñ–Ð¹.",
  "patch": {
    "css": "/* === v3.7.0 â€” design, training overlay, AI, menu, i18n polish === */:root{--glass:rgba(255,255,255,.06)}/* NeonGlass theme */body.theme-glass{background:radial-gradient(1200px 600px at 10% -10%,rgba(122,140,255,.12),transparent),linear-gradient(140deg,#0a0f1f,#0b1234);}body.theme-glass .card,body.theme-glass .ai-panel,body.theme-glass #sideMenu{background:var(--glass);backdrop-filter:saturate(1.4) blur(6px)}/* Training overlay fixes */.teach-ol{pointer-events:auto}.teach-ol.active{display:flex}.teach-spot{transition:all .15s ease}/* AI panel improvements */.ai-panel{resize:both;overflow:auto;cursor:default}.ai-panel .drag{cursor:move; user-select:none}#aiMin{margin-left:auto}.ai-sugg{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}.ai-sugg .btn{padding:6px 8px;font-size:12px}/* Trash (floating) */#binFab{position:fixed;right:18px;bottom:18px;z-index:38;border:1px solid #3a47a2;background:#0f1530;color:#e7ecff;border-radius:50%;width:46px;height:46px;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 24px rgba(0,0,0,.25)}#binFab:active{transform:scale(.96)}/* Side menu */#sideMenu{position:fixed;left:12px;top:12px;bottom:12px;width:64px;border:1px solid var(--border);border-radius:16px;padding:8px;z-index:37;display:flex;flex-direction:column;gap:8px}#sideMenu .m{display:flex;align-items:center;justify-content:center;height:44px;border:1px solid var(--border);border-radius:12px;cursor:pointer}#sideMenu .m.active{box-shadow:0 0 0 2px rgba(122,140,255,.35) inset}#menuToggle{position:fixed;left:88px;top:16px;z-index:36}/* i18n hint pill */.i18n-pill{border:1px solid var(--border);border-radius:999px;padding:2px 8px;margin-left:6px;font-size:12px}/* Compact mode */.compact .card,.compact input,.compact select,.compact textarea,.compact .btn{--radius:10px;--fs:13px}/* Virtual table helper */#virtInfo{font-size:12px;opacity:.85;margin-top:4px}",
    "js": "(function(){const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));const load=(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(d))}catch(e){return d}};const toast=t=>{const el=$('#toast');if(!el)return;el.textContent=t;el.classList.remove('hidden');setTimeout(()=>el.classList.add('hidden'),2200)};/* ================= 0) THEME: NeonGlass preset ================= */(function glassTheme(){const cfg=load('mw_design_cfg',{});if(!cfg.stylePresetAdded){cfg.stylePresetAdded=true;save('mw_design_cfg',cfg);}if($('#presetGlass'))return;const host=$('#designPanel');if(!host)return;const b=document.createElement('button');b.id='presetGlass';b.className='btn';b.textContent='NeonGlass';host.appendChild(b);b.onclick=()=>{document.body.classList.add('theme-glass');toast('Ð¢ÐµÐ¼Ð° NeonGlass Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°')};})();/* ================= 1) TRAINING â€” close/lock stray panels & AI ================= */(function trainingFixes(){const hideStray=()=>{$('#crmDrop')?.classList.add('hidden');$('#crmBack')?.classList.add('hidden');$('#aiPanel')?.classList.remove('active')};document.addEventListener('click',e=>{if(e.target?.id==='teachStart'){hideStray()}});/* Ð¿ÐµÑ€ÐµÑ…Ð¾Ð¿Ð¸Ñ‚Ð¸ Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ñ‚Ñ */window.MW_TRAIN && (function wrapOpen(){const o=window.MW_TRAIN.open;window.MW_TRAIN.open=function(){hideStray();o.call(window.MW_TRAIN)}})();/* Ð½Ð° Ð·Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ â€” Ñ‚ÐµÐ¶ Ð¿Ñ€Ð¸Ð±Ñ€Ð°Ñ‚Ð¸ ÑÐ¿Ð¾Ñ‚ */window.MW_TRAIN && (function wrapClose(){const c=window.MW_TRAIN.close;window.MW_TRAIN.close=function(){c.call(window.MW_TRAIN);const s=document.querySelector('.teach-spot');s&&s.classList.remove('active')}})();})();/* ================= 2) AI Assistant â€” draggable + quick actions ================= */(function aiPro(){const p=$('#aiPanel');if(!p)return;const head=p.querySelector('.ai-head');if(head && !head.classList.contains('drag')){head.classList.add('drag');let sx=0,sy=0,px=0,py=0,drag=false;head.addEventListener('mousedown',e=>{drag=true;sx=e.clientX;sy=e.clientY;px=p.offsetLeft;py=p.offsetTop;document.body.style.userSelect='none'});document.addEventListener('mouseup',()=>{drag=false;document.body.style.userSelect=''});document.addEventListener('mousemove',e=>{if(!drag)return;p.style.left=(px+e.clientX-sx)+'px';p.style.top=(py+e.clientY-sy)+'px'})}if(!$('#aiMin')){const btn=document.createElement('button');btn.id='aiMin';btn.className='btn btn-secondary';btn.textContent='â€“';head.insertBefore(btn, head.querySelector('#aiClose'));btn.onclick=()=>p.classList.toggle('active')}if(!p.querySelector('.ai-sugg')){const bar=document.createElement('div');bar.className='ai-sugg';bar.innerHTML=`<button class='btn' data-act='new'>+ Lead</button><button class='btn' data-act='find'>Find duplicates</button><button class='btn' data-act='sum'>Summarize table</button>`;p.appendChild(bar);bar.addEventListener('click',e=>{const a=e.target.closest('[data-act]');if(!a)return;const act=a.dataset.act;if(act==='new'){const n=prompt('Name?');if(!n)return;$('#name').value=n;$('#phone').value='+380';$('#leadForm button[type=\"submit\"]').click();toast('Ð›Ñ–Ð´ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¾')}if(act==='find'){document.querySelector('#mergeDupBtn')?.click()}if(act==='sum'){const a=load('leads',[]);alert('Ð›Ñ–Ð´Ñ–Ð²: '+a.length)}})}})();/* ================= 3) I18N â€” FULL COVERAGE (UA/EN) ================= */(function i18nFull(){const KEY='mw_lang';const DICT={uk:{'Interface language':'ÐœÐ¾Ð²Ð° Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ','Sign in':'Ð£Ð²Ñ–Ð¹Ñ‚Ð¸','Sign out':'Ð’Ð¸Ð¹Ñ‚Ð¸','Create account':'Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð°ÐºÐ°ÑƒÐ½Ñ‚','Forgot password':'Ð—Ð°Ð±ÑƒÐ² Ð¿Ð°Ñ€Ð¾Ð»ÑŒ','Guide':'ÐœÐ°Ð¹ÑÑ‚ÐµÑ€','Install':'Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸','Check updates':'ÐŸÐ¾ÑˆÑƒÐº Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ','Settings':'ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ','Leads':'Ð›Ñ–Ð´Ð¸','Kanban':'ÐšÐ°Ð½Ð±Ð°Ð½','Admin':'ÐÐ´Ð¼Ñ–Ð½','Updates':'ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ','Search':'ÐŸÐ¾ÑˆÑƒÐº','Name':'Ð†Ð¼Ê¼Ñ','Phone':'Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½','Email':'Ð•Ð¼ÐµÐ¹Ð»','Status':'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ','Tags':'Ð¢ÐµÐ³Ð¸','Comment':'ÐšÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€','New':'ÐÐ¾Ð²Ð¸Ð¹','In progress':'Ð’ Ð¾Ð±Ñ€Ð¾Ð±Ñ†Ñ–','Done':'Ð—Ð°ÐºÑ€Ð¸Ñ‚Ð¸Ð¹','Rejected':'Ð’Ñ–Ð´Ñ…Ð¸Ð»ÐµÐ½Ð¸Ð¹','Trash':'ÐšÐ¾ÑˆÐ¸Ðº','Print':'Ð”Ñ€ÑƒÐº'},en:{'ÐœÐ¾Ð²Ð° Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ':'Interface language','Ð£Ð²Ñ–Ð¹Ñ‚Ð¸':'Sign in','Ð’Ð¸Ð¹Ñ‚Ð¸':'Sign out','Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð°ÐºÐ°ÑƒÐ½Ñ‚':'Create account','Ð—Ð°Ð±ÑƒÐ² Ð¿Ð°Ñ€Ð¾Ð»ÑŒ':'Forgot password','ÐœÐ°Ð¹ÑÑ‚ÐµÑ€':'Guide','Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ð¸':'Install','ÐŸÐ¾ÑˆÑƒÐº Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ':'Check updates','ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ':'Settings','Ð›Ñ–Ð´Ð¸':'Leads','ÐšÐ°Ð½Ð±Ð°Ð½':'Kanban','ÐÐ´Ð¼Ñ–Ð½':'Admin','ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ':'Updates','ÐŸÐ¾ÑˆÑƒÐº':'Search','Ð†Ð¼Ê¼Ñ':'Name','Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½':'Phone','Ð•Ð¼ÐµÐ¹Ð»':'Email','Ð¡Ñ‚Ð°Ñ‚ÑƒÑ':'Status','Ð¢ÐµÐ³Ð¸':'Tags','ÐšÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€':'Comment','ÐÐ¾Ð²Ð¸Ð¹':'New','Ð’ Ð¾Ð±Ñ€Ð¾Ð±Ñ†Ñ–':'In progress','Ð—Ð°ÐºÑ€Ð¸Ñ‚Ð¸Ð¹':'Done','Ð’Ñ–Ð´Ñ…Ð¸Ð»ÐµÐ½Ð¸Ð¹':'Rejected','ÐšÐ¾ÑˆÐ¸Ðº':'Trash','Ð”Ñ€ÑƒÐº':'Print'}};function getLang(){return localStorage.getItem(KEY)||'uk'}function tr(txt){const l=getLang();if(l==='uk') return DICT.en[txt]?txt:(DICT.uk[txt]||txt);if(l==='en') return DICT.en[txt]||txt;return txt}function translateTree(root){const walker=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,null);const texts=[];while(walker.nextNode())texts.push(walker.currentNode);texts.forEach(n=>{const s=n.nodeValue.trim();if(!s)return;const rep=tr(s);if(rep!==s)n.nodeValue=n.nodeValue.replace(s,rep)});/* placeholders/titles */$$('*[placeholder]').forEach(el=>{const s=el.getAttribute('placeholder');const rep=tr(s);if(rep!==s)el.setAttribute('placeholder',rep)});$$('*[title]').forEach(el=>{const s=el.getAttribute('title');const rep=tr(s);if(rep!==s)el.setAttribute('title',rep)});/* aria-label */$$('*[aria-label]').forEach(el=>{const s=el.getAttribute('aria-label');const rep=tr(s);if(rep!==s)el.setAttribute('aria-label',rep)})}function apply(){translateTree(document.body)}apply();/* live translate new nodes */const mo=new MutationObserver(m=>m.forEach(rec=>rec.addedNodes&&rec.addedNodes.forEach(n=>{if(n.nodeType===1)translateTree(n)})));mo.observe(document.body,{childList:true,subtree:true});window.forceTranslate=apply})();/* ================= 4) Trash FAB + Side Menu ================= */(function uiNav(){if(!$('#binFab')){const f=document.createElement('button');f.id='binFab';f.title='ÐšÐ¾ÑˆÐ¸Ðº';f.innerHTML='ðŸ—‘';document.body.appendChild(f);f.onclick=()=>{$('#openTrash')?.click()}}if(!$('#sideMenu')){const m=document.createElement('div');m.id='sideMenu';m.innerHTML=`<div class='m' data-tab='tabForm'>L</div><div class='m' data-tab='tabKanban'>K</div><div class='m' data-tab='tabSettings'>S</div><div class='m' data-tab='tabAdmin'>A</div><div class='m' data-tab='tabUpdates'>U</div><div class='m' data-tab='bin'>ðŸ—‘</div>`;document.body.appendChild(m);m.addEventListener('click',e=>{const t=e.target.closest('.m');if(!t)return;$$('#sideMenu .m').forEach(x=>x.classList.remove('active'));t.classList.add('active');const tb=t.dataset.tab;if(tb==='bin') return $('#openTrash')?.click();$('#'+tb)?.click()});const tog=document.createElement('button');tog.id='menuToggle';tog.className='btn';tog.textContent='â‰¡';document.body.appendChild(tog);let open=true;tog.onclick=()=>{open=!open;$('#sideMenu').style.display=open?'flex':'none'}}})();/* ================= 5) Search debounce + virtual rows ================= */(function perf(){const s=$('#searchInput');if(s&&!s.dataset.debounced){s.dataset.debounced='1';let t=0;s.addEventListener('input',()=>{clearTimeout(t);t=setTimeout(()=>{window.renderTable&&window.renderTable()},120)})}const tb=$('#leadsTable tbody');if(!tb)return;if($('#virtInfo'))return;const info=document.createElement('div');info.id='virtInfo';info.className='muted';tb.parentElement.appendChild(info);function onScroll(){const rows=[...tb.children];const h=tb.parentElement.clientHeight||480;const top=tb.parentElement.scrollTop||0;const per=32;const start=Math.max(0,Math.floor(top/per)-10);const end=Math.min(rows.length,Math.ceil((top+h)/per)+10);rows.forEach((tr,i)=>{tr.style.display=(i>=start&&i<=end)?'':'none'});info.textContent='ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ð¾: '+(end-start)+' Ð· '+rows.length}tb.parentElement.addEventListener('scroll',onScroll,{passive:true});const old=window.renderTable;window.renderTable=function(){old&&old();requestIdleCallback?requestIdleCallback(onScroll):setTimeout(onScroll,50)};onScroll();})();/* ================= 6) Compact mode toggle ================= */(function compact(){if($('#compactToggle'))return;const host=$('#settingsSection');if(!host)return;const btn=document.createElement('button');btn.id='compactToggle';btn.className='btn btn-secondary';btn.textContent='Compact UI';host.appendChild(btn);btn.onclick=()=>{document.body.classList.toggle('compact');toast('Compact: '+(document.body.classList.contains('compact')?'on':'off'))}})();/* ================= 7) Accessibility polish + keyboard ================= */(function a11y(){document.addEventListener('keydown',e=>{if(e.key==='/' && !e.target.closest('input,textarea')){e.preventDefault();$('#searchInput')?.focus()}});$$('button, a, input, select, textarea').forEach(el=>{el.addEventListener('focus',()=>{el.style.outline='2px solid #7cc8ff'});el.addEventListener('blur',()=>{el.style.outline='none'})})})();/* ================= 8) Fix EN language not applying enough ================= */(function langHotApply(){const sel=$('#langSel');if(!sel)return;sel.addEventListener('change',()=>{setTimeout(()=>{window.forceTranslate&&window.forceTranslate();toast('Language applied')},20)})})();})();"
  }
}
