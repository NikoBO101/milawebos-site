<!doctype html>\n<html lang="uk" data-theme="light"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="app-version" content="1.6.0">
  <title>MilaWEBOS CRM (v1.6.0) ‚Äî MilaWEBOS</title>
  <style>
    :root {
      --bg: #0e1220; --card:#161b2e; --text:#e6e8f0; --muted:#9aa3b2;
      --accent:#6ea8ff; --accent2:#a78bfa; --border:#222846; --ok:#38d9a9; --err:#ff6b6b;
      --input:#0f1426;
    }
    [data-theme="light"] {
      --bg:#f6f7fb; --card:#ffffff; --text:#141a2e; --muted:#4b5569;
      --accent:#3a7bff; --accent2:#7c5cff; --border:#e5e8f3; --input:#f3f6ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
    #particles-js{position:fixed;inset:0;z-index:0;pointer-events:none}
    .app{position:relative;z-index:1;max-width:1180px;margin:0 auto;padding:24px}
    header{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px}
    .title{font-weight:800;letter-spacing:.3px;font-size:20px;display:flex;gap:10px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 0 16px var(--accent)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    button{background:linear-gradient(135deg,#1e2542,#19213a);color:#e6e8f0;border:1px solid var(--border);padding:10px 14px;border-radius:12px;cursor:pointer;transition:transform .06s,box-shadow .2s,border-color .2s}
    [data-theme="light"] button{background:linear-gradient(135deg,#f6f7ff,#e9edff);color:#141a2e}
    button:hover{transform:translateY(-1px);border-color:#2b3360;box-shadow:0 6px 18px rgba(0,0,0,.12)}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .btn-secondary{background:#141a31}
    [data-theme="light"] .btn-secondary{background:#eef2ff}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:rgba(22,27,46,.82);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.25);backdrop-filter:blur(4px)}
    [data-theme="light"] .card{background:#fff;box-shadow:0 8px 26px rgba(34,40,70,.08)}
    h2{margin:0 0 12px;font-size:18px;font-weight:800;color:#dbe1ff}
    [data-theme="light"] h2{color:#1c2342}
    label{display:block;font-size:14px;margin:8px 0 6px;color:var(--muted)}
    input[type="text"],input[type="email"],select,textarea{width:100%;background:var(--input);color:var(--text);border:1px solid #262c4d;border-radius:10px;padding:10px 12px;outline:none;transition:border-color .2s,box-shadow .2s}
    [data-theme="light"] input[type="text"],[data-theme="light"] input[type="email"],[data-theme="light"] select,[data-theme="light"] textarea{border-color:#d9def0}
    input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(110,168,255,.15)}
    textarea{min-height:90px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:var(--muted)}
    .hidden{display:none}
    .section{opacity:0;transform:translateY(8px);transition:opacity .2s,transform .2s}
    .section.active{opacity:1;transform:none}
    .table-wrap{overflow:auto;max-height:360px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #242a4a;padding:8px 10px;font-size:14px}
    [data-theme="light"] th, [data-theme="light"] td { border-bottom:1px solid #edf0fb }
    th{text-align:left;color:#bfc7e6}
    [data-theme="light"] th{color:#1f2750}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#1a2140;border:1px solid #2b3360;font-size:12px;color:#cfe2ff}
    [data-theme="light"] .pill{background:#eef2ff;border-color:#d8def4;color:#2a335a}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .chart-box{height:260px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#0c1122;border:1px solid #222847;padding:2px 6px;border-radius:6px}
    [data-theme="light"] .kbd{background:#f3f6ff;border-color:#d8def4}
    .update-panel{display:grid;gap:10px}
    .update-summary{background:#0f1426;border:1px dashed #2b3360;border-radius:12px;padding:12px}
    [data-theme="light"] .update-summary{background:#f8faff;border-color:#d8def4}
    .update-summary h3{margin:0 0 6px;font-size:16px;color:#bfe0ff}
    [data-theme="light"] .update-summary h3{color:#243062}
    .changes{margin:8px 0 0;padding-left:18px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
    .toast{position:fixed;right:16px;bottom:16px;background:#0f1426;border:1px solid #2b3360;color:#cfe2ff;padding:10px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.25);z-index:9}
    [data-theme="light"] .toast{background:#ffffff;color:#1f2750;border-color:#d8def4}
    @media(max-width:720px){.row{grid-template-columns:1fr}}
  </style>
<style>/* –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ª–µ–≥–∫—ñ –∞–∫—Ü–µ–Ω—Ç–∏ */ .title .dot{box-shadow:0 0 22px #3a7bff} .card{border-color: rgba(36,48,98,.15)}</style><style>
/* --- Training overlay styles --- */
#coachOverlay { position: fixed; inset: 0; background: rgba(0,0,0,.35); backdrop-filter: blur(1px); z-index: 50; display: none; }
#coachHighlight { position: fixed; border: 2px solid #6ea8ff; border-radius: 10px; box-shadow: 0 0 0 9999px rgba(0,0,0,.35); pointer-events: none; }
#coachTooltip { position: fixed; max-width: 360px; background: var(--card); color: var(--text); border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: 0 8px 30px rgba(0,0,0,.25); z-index: 51; }
#coachTooltip h4 { margin: 0 0 6px; font-size: 16px; color: #dbe1ff }
#coachTooltip p { margin: 0 0 10px; font-size: 14px; color: var(--muted) }
#coachTooltip .row { display:flex; gap:8px; }
#coachTooltip button { flex:1 }
#nikFooter { position: fixed; left: 16px; bottom: 10px; z-index: 9; opacity: .85; font-size: 12px; }
#nikFooter .badge { display:inline-block; padding: 3px 8px; border-radius: 999px; background: #0f1426; border: 1px solid #2b3360; color: #cfe2ff }
[data-theme="light"] #nikFooter .badge { background: #fff; border-color: #d8def4; color: #2a335a }
#crmOptionsCard .opts { display: grid; grid-template-columns: repeat(2, minmax(160px,1fr)); gap: 8px; }
#crmOptionsCard .opts button { text-align: left }
@media (max-width: 720px) { #coachTooltip { max-width: 92vw } #crmOptionsCard .opts { grid-template-columns: 1fr } }
</style><style>
/* === v1.6.0 UI Enhancements === */
.token-wrap{display:flex;flex-wrap:wrap;gap:6px;align-items:center;background:var(--input);border:1px solid #262c4d;border-radius:10px;padding:6px 8px}
[data-theme="light"] .token-wrap{border-color:#d8def4}
.token{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;background:#1a2140;border:1px solid #2b3360;color:#cfe2ff;font-size:12px}
.token .x{cursor:pointer;opacity:.8}
[data-theme="light"] .token{background:#eef2ff;border-color:#d8def4;color:#2a335a}
.token-input{border:0;outline:0;background:transparent;color:var(--text);min-width:120px;padding:6px 4px}
.tag-suggest{position:absolute;z-index:5; background:var(--card); border:1px solid var(--border); border-radius:8px; padding:6px; box-shadow:0 8px 30px rgba(0,0,0,.25)}
.tag-suggest button{display:block;width:100%;text-align:left;margin:2px 0}
.customize-bar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.grid-draggable{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
.widget{grid-column:span 6;background:rgba(22,27,46,.82);border:1px solid var(--border);border-radius:14px;padding:12px;cursor:move}
[data-theme="light"] .widget{background:#fff;box-shadow:0 8px 26px rgba(34,40,70,.08)}
.widget.dragging{opacity:.6}
.edit-modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}
.edit-card{width:min(560px,92vw);background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.edit-card h3{margin:0 0 10px;color:#dbe1ff}
.stats-grid{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:12px}
@media(max-width:720px){.widget{grid-column:span 12}.stats-grid{grid-template-columns:1fr}}
.update-manager{margin-top:8px;border:1px dashed var(--border);border-radius:10px;padding:10px}
.tree ul{list-style:none;padding-left:14px}
.tree li{margin:2px 0}
.footer-nik{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
</style></head>
<body>
  <div id="particles-js"><canvas class="particles-js-canvas-el" width="1905" height="945" style="width: 100%; height: 100%;"></canvas></div>
  <div class="app">
    <header>
      <div class="title"><span class="dot"></span> <span id="appTitle">MilaWEBOS CRM (v1.6.0)</span> <span class="pill" id="currentVersion">v1.6.0</span></div>
      <div class="actions">
        <button id="viewLeadsBtn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª—ñ–¥–∏</button>
        <button id="settingsBtn" class="btn-secondary">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
        <button id="advancedFeaturesBtn" class="btn-secondary">–†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</button>
        <button id="themeToggleBtn" title="–°–≤—ñ—Ç–ª–∞/–¢–µ–º–Ω–∞">üåì –¢–µ–º–∞</button>
      </div>
    </header>

    <section id="formSection" class="section card hidden"><div class="customize-bar" id="customizeBar"><button id="startCustomize">üîß –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å</button><button id="saveLayout" class="btn-secondary" disabled="">–ó–±–µ—Ä–µ–≥—Ç–∏ –º–∞–∫–µ—Ç</button></div>
      <h2>–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞</h2>
      <div class="toolbar">
        <input id="searchInput" placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º º—è–º/—Ç–µ–ª–µ—Ñ–æ–Ω–æ–º/email/—Ç–µ–≥–∞–º–∏" style="flex:1; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:var(--input); color:var(--text)">
        <select id="filterStatus">
          <option value="">–°—Ç–∞—Ç—É—Å: —É—Å—ñ</option>
          <option>–ù–æ–≤–∏–π</option><option>–í –æ–±—Ä–æ–±—Ü—ñ</option><option>–ó–∞–∫—Ä–∏—Ç–∏–π</option><option>–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π</option>
        </select>
        
        
        
        <button id="bulkInProgressBtn">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω–µ ¬´–í –æ–±—Ä–æ–±—Ü—ñ¬ª</button>
      </div>
      <div class="card" id="crmOptionsCard">
      <h2>–û–ø—Ü—ñ—ó CRM</h2>
      <div class="opts">
        <button id="optCreateLead">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ–¥ (—à–≤–∏–¥–∫–æ)</button>
        <button id="optFindLead">üîé –ó–Ω–∞–π—Ç–∏ –ª—ñ–¥</button>
        <button id="optBulkStatus">üì¶ –ú–∞—Å–æ–≤–æ: ¬´–í –æ–±—Ä–æ–±—Ü—ñ¬ª</button>
        <button id="optDetectDup">üß≠ –ü–æ—à—É–∫ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤</button>
        <button id="optMarkPriority">‚≠ê –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</button>
        <button id="optAddTag">üè∑Ô∏è –î–æ–¥–∞—Ç–∏ —Ç–µ–≥</button>
        <button id="optQuickNote">üóíÔ∏è –®–≤–∏–¥–∫–∞ –Ω–æ—Ç–∞—Ç–∫–∞</button>
        <button id="optAssign">üë§ –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–≥–æ</button>
        <button id="optArchive">üóÉÔ∏è –ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏</button>
        <button id="optRestore">‚ôªÔ∏è –í—ñ–¥–Ω–æ–≤–∏—Ç–∏</button>
      </div></div><form id="leadForm">
        <div class="row">
          <div><label for="name">–Ü–º º—è</label><input type="text" id="name" placeholder="–ù–∞–ø—Ä., –ú–∞—Ä—ñ—è"></div>
          <div><label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="text" id="phone" placeholder="+380‚Ä¶"></div>
        </div>
        <div class="row">
          <div><label for="email">Email</label><input type="email" id="email" placeholder="user@example.com"></div>
          <div><label for="status">–°—Ç–∞—Ç—É—Å</label>
            <select id="status"><option>–ù–æ–≤–∏–π</option><option>–í –æ–±—Ä–æ–±—Ü—ñ</option><option>–ó–∞–∫—Ä–∏—Ç–∏–π</option><option>–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π</option></select>
          </div>
        </div>
        <div class="row">
          <div><label for="tags">–¢–µ–≥–∏</label><div class="token-wrap"><input class="token-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥ —ñ Enter"></div><input type="text" id="tags" placeholder="facebook, –≥–∞—Ä—è—á–∏–π, ..." style="display: none;"></div>
          <div><label for="comment">–ö–æ–º–µ–Ω—Ç–∞—Ä</label><textarea id="comment" placeholder="–î–µ—Ç–∞–ª—ñ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è‚Ä¶"></textarea></div>
        </div>
        <div style="display:flex; gap:8px; align-items:center; margin-top:10px">
          <button type="submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
          <span id="successMessage" class="ok hidden">‚úÖ –ó–∞—è–≤–∫—É –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ</span>
          <span id="errorMessage" class="err hidden">‚õî –í–∫–∞–∂—ñ—Ç—å —Ö–æ—á–∞ –± —Ç–µ–ª–µ—Ñ–æ–Ω –∞–±–æ email</span>
        </div>
      </form>
      <div class="table-wrap card" style="margin-top:12px">
        <table id="leadsTable"><thead><tr>
          <th><input type="checkbox" id="selectAll"></th>
          <th>ID</th><th>–Ü–º º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>Email</th><th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th><th>–°—Ç–∞—Ç—É—Å</th><th>–¢–µ–≥–∏</th><th>–î–∞—Ç–∞</th><th>–û—Ü—ñ–Ω–∫–∞</th><th>–î—ñ—ó</th>
        </tr></thead><tbody></tbody></table>
      </div>
      <div class="card chart-box" style="margin-top:12px"><canvas id="leadsChart" style="display: block; box-sizing: border-box; height: 226px; width: 1064px;" width="1064" height="226"></canvas></div>
    </section>

    <section id="leadsSection" class="section card hidden">
      <h2>–õ—ñ–¥–∏ (–ø–µ—Ä–µ–≥–ª—è–¥)</h2>
      <div class="table-wrap card">
        <table id="leadsTable2"><thead><tr>
          <th>ID</th><th>–Ü–º º—è</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>Email</th><th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th><th>–°—Ç–∞—Ç—É—Å</th><th>–¢–µ–≥–∏</th><th>–î–∞—Ç–∞</th><th>–û—Ü—ñ–Ω–∫–∞</th>
        </tr></thead><tbody></tbody></table>
      </div>
      <div class="card chart-box" style="margin-top:12px"><canvas id="leadsChart2" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas></div>
      <div style="margin-top:12px"><button id="backToFormBtn">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —Ñ–æ—Ä–º–∏</button></div>
    </section>

    <section id="settingsSection" class="section card active">
      <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
      <div class="grid"><div class="update-manager" id="updateManager"><h3>–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω—å (.mmur)</h3>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <button id="umPick">–í–∏–±—Ä–∞—Ç–∏ –ø–∞–ø–∫—É</button>
        <button id="umScan">–°–∫–∞–Ω—É–≤–∞—Ç–∏</button>
        <button id="umInstall" class="btn-secondary" disabled="">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω–µ</button>
      </div>
      <div class="tree" id="umTree"></div></div><button id="startTrainingBtn" style="margin: 8px 0px;">–ù–∞–≤—á–∞–Ω–Ω—è (–∫—É—Ä—Å)</button>
        <div class="card update-panel">
          <div class="muted">–û–Ω–æ–≤–ª–µ–Ω–Ω—è (.mmur) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ —É –≤–∏–±—Ä–∞–Ω—ñ–π –ø–∞–ø—Ü—ñ</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button id="pickUpdateFolderBtn">–í–∏–±—Ä–∞—Ç–∏ –ø–∞–ø–∫—É –æ–Ω–æ–≤–ª–µ–Ω—å</button>
            <button id="checkUpdateBtn">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞—Ä–∞–∑</button>
            <button id="installUpdateBtn" class="btn-secondary">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏</button>
            <button id="saveAsCurrentBtn" title="–ó–±–µ—Ä–µ–≥—Ç–∏ HTML –∑ –∞–∫—Ç–∏–≤–Ω–∏–º–∏ –ø–∞—Ç—á–∞–º–∏">–ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ –ø–æ—Ç–æ—á–Ω—É –≤–µ—Ä—Å—ñ—é</button>
          </div>
          <div id="updateSummary" class="update-summary">
            <h3>–ó–Ω–∞–π–¥–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</h3>
            <div id="updateMeta"><div>–í–µ—Ä—Å—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <span class="pill">v1.6.0</span></div>
                             <div>–î–∞—Ç–∞: <span class="pill">2025-11-03</span></div>
                             <div>–ú—ñ–Ω. –≤–µ—Ä—Å—ñ—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É: <span class="pill">v1.1.0</span></div></div>
            <ul id="updateChanges" class="changes"><li>–¢–µ–≥–∏: Enter –¥–æ–¥–∞—î, —ñ—Å—Ç–æ—Ä—ñ—è —Ç–µ–≥—ñ–≤ —ñ –ø—ñ–¥–∫–∞–∑–∫–∏, –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏.</li><li>–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ª—ñ–¥—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ.</li><li>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –¥—ñ–∞–≥—Ä–∞–º–∞ —Å—Ç–∞—Ç—É—Å—ñ–≤ —ñ –≥—Ä–∞—Ñ—ñ–∫ –ø–æ –¥–Ω—è—Ö.</li><li>–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è: –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ (–ø–∞–∑–ª), –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞–∫–µ—Ç–∞.</li><li>–ë–µ–∫–∞–ø/–≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è JSON (–ª—ñ–¥–∏, —Ç–µ–º–∞, –ø–∞—Ç—á—ñ, —ñ—Å—Ç–æ—Ä—ñ—è —Ç–µ–≥—ñ–≤).</li><li>–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω—å: –≤–∏–±—ñ—Ä –ø–∞–ø–∫–∏, —Å–∫–∞–Ω –ø–∞–ø–æ–∫/–ø—ñ–¥–ø–∞–ø–æ–∫, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è .mmur.</li><li>–ü—Ä–∏–±—Ä–∞–Ω–æ –ï–∫—Å–ø–æ—Ä—Ç/–Ü–º–ø–æ—Ä—Ç CSV –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω—É (—Ç–∏–º—á–∞—Å–æ–≤–æ).</li><li>–°–≤—ñ—Ç–ª—ñ—à—ñ —Å—Ç–∏–ª—ñ, –æ—Ö–∞–π–Ω—ñ—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏/—Ç—ñ–Ω—ñ.</li><li>–í–µ—Ä—Å—ñ—è –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∑–≤–µ—Ä—Ö—É (v1.6.0).</li><li>–§—É—Ç–µ—Ä ¬´Powered By NikolosBond ¬∑ Developer¬ª.</li></ul>
            <div class="muted" id="updateNote">–ì–ª–æ–±–∞–ª—å–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è: —Ç–µ–≥–∏ –∑ Enter —ñ —ñ—Å—Ç–æ—Ä—ñ—î—é, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ª—ñ–¥—ñ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è (drag&amp;drop), –±–µ–∫–∞–ø, –º–µ–Ω–µ–¥–∂–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω—å –ø–æ –ø–∞–ø–∫–∞—Ö. –¢–æ–Ω–∫–µ –ø–æ–ª—ñ—Ä—É–≤–∞–Ω–Ω—è UI.</div>
            <div class="muted" id="updateModeInfo"><div>–†–µ–∂–∏–º: <span class="pill">patch-persist</span></div></div>
          </div>
          <div class="muted">–ü—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –ø–∞–ø–∫–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ —Å–∫–∞–Ω—É–≤–∞—Ç–∏–º–µ <span class="kbd">.mmur</span>-—Ñ–∞–π–ª–∏ —ñ –ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏–º–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è. –î–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É <b>–≤ —Ü–µ–π —Å–∞–º–∏–π HTML</b> –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è File System Access API ‚Äî –∑ º—è–≤–∏—Ç—å—Å—è –¥—ñ–∞–ª–æ–≥ <i>–ó–±–µ—Ä–µ–≥—Ç–∏</i>.</div>
        </div>
        <div class="card">
          <div class="muted" style="margin-bottom:8px">–ñ—É—Ä–Ω–∞–ª –¥—ñ–π</div>
          <ul id="logList" style="list-style:none; padding-left:0; margin:0; display:grid; gap:6px"></ul>
        </div>
      <div class="card" id="backupBar"><h2>–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è</h2>
      <button id="backupBtn">–ó—Ä–æ–±–∏—Ç–∏ –±–µ–∫–∞–ø</button>
      <input id="restoreFile" type="file" accept=".json" class="hidden">
      <button id="restoreBtn" class="btn-secondary">–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ —Ñ–∞–π–ª—É</button>
      <div class="footer-nik">Powered By <b>NikolosBond</b> ¬∑ Developer</div></div></div>
    </section>

    <section id="advancedFeaturesSection" class="section card hidden">
      <h2>–†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</h2>
      <div class="grid">
        <div class="card">
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button id="generateReportBtn">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
            <button id="scheduleMeetingBtn">–ó–∞–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –∑—É—Å—Ç—Ä—ñ—á</button>
            <button id="clearDataBtn">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ</button>
          </div>
          <div id="generatedReport" class="card" style="margin-top:10px"></div>
          <div id="scheduledMeeting" class="pill" style="margin-top:10px"></div>
        </div>
      <div class="card" id="statsBlock"><h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div class="stats-grid">
        <div class="card"><canvas id="chartStatusPie" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas></div>
        <div class="card"><canvas id="chartByDay" height="0" style="display: block; box-sizing: border-box; height: 0px; width: 0px;" width="0"></canvas></div>
      </div></div></div>
    </section>
  </div>

  <div id="toast" class="toast">–ó–Ω–∞–π–¥–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è MilaWEBOS_update_v1.6.0.mmur</div>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –ø–∞—Ç—á—ñ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
  <script id="applied-patches" type="application/json">{"applied":[{"patch":{"cssVars":{},"css":"/* –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ª–µ–≥–∫—ñ –∞–∫—Ü–µ–Ω—Ç–∏ */ .title .dot{box-shadow:0 0 22px #3a7bff} .card{border-color: rgba(36,48,98,.15)}","title":"MilaWEBOS CRM (Light)","js":"try{document.documentElement.setAttribute('data-theme','light');localStorage.setItem('theme','light');}catch(e){}"}},{"patch":{"cssVars":{},"css":"\n/* --- Training overlay styles --- */\n#coachOverlay { position: fixed; inset: 0; background: rgba(0,0,0,.35); backdrop-filter: blur(1px); z-index: 50; display: none; }\n#coachHighlight { position: fixed; border: 2px solid #6ea8ff; border-radius: 10px; box-shadow: 0 0 0 9999px rgba(0,0,0,.35); pointer-events: none; }\n#coachTooltip { position: fixed; max-width: 360px; background: var(--card); color: var(--text); border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: 0 8px 30px rgba(0,0,0,.25); z-index: 51; }\n#coachTooltip h4 { margin: 0 0 6px; font-size: 16px; color: #dbe1ff }\n#coachTooltip p { margin: 0 0 10px; font-size: 14px; color: var(--muted) }\n#coachTooltip .row { display:flex; gap:8px; }\n#coachTooltip button { flex:1 }\n#nikFooter { position: fixed; left: 16px; bottom: 10px; z-index: 9; opacity: .85; font-size: 12px; }\n#nikFooter .badge { display:inline-block; padding: 3px 8px; border-radius: 999px; background: #0f1426; border: 1px solid #2b3360; color: #cfe2ff }\n[data-theme=\"light\"] #nikFooter .badge { background: #fff; border-color: #d8def4; color: #2a335a }\n#crmOptionsCard .opts { display: grid; grid-template-columns: repeat(2, minmax(160px,1fr)); gap: 8px; }\n#crmOptionsCard .opts button { text-align: left }\n@media (max-width: 720px) { #coachTooltip { max-width: 92vw } #crmOptionsCard .opts { grid-template-columns: 1fr } }\n","title":"MilaWEBOS CRM (v1.5.0)","js":"\n(function(){\n  // ---- Helper: goto section (independent of app's internal function)\n  function gotoSection(id){\n    document.querySelectorAll('.section').forEach(s=>{ s.classList.add('hidden'); s.classList.remove('active'); });\n    const el = document.getElementById(id);\n    if (el){ el.classList.remove('hidden'); setTimeout(()=>el.classList.add('active'), 10); }\n  }\n\n  // ---- 1) Add CRM Options panel with 10 actions\n  function ensureCrmOptions(){\n    if (document.getElementById('crmOptionsCard')) return;\n    const formSection = document.getElementById('formSection');\n    if (!formSection) return;\n    const card = document.createElement('div');\n    card.className = 'card'; card.id = 'crmOptionsCard';\n    card.innerHTML = `\n      <h2>–û–ø—Ü—ñ—ó CRM</h2>\n      <div class=\"opts\">\n        <button id=\"optCreateLead\">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ–¥ (—à–≤–∏–¥–∫–æ)</button>\n        <button id=\"optFindLead\">üîé –ó–Ω–∞–π—Ç–∏ –ª—ñ–¥</button>\n        <button id=\"optBulkStatus\">üì¶ –ú–∞—Å–æ–≤–æ: ¬´–í –æ–±—Ä–æ–±—Ü—ñ¬ª</button>\n        <button id=\"optDetectDup\">üß≠ –ü–æ—à—É–∫ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤</button>\n        <button id=\"optMarkPriority\">‚≠ê –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</button>\n        <button id=\"optAddTag\">üè∑Ô∏è –î–æ–¥–∞—Ç–∏ —Ç–µ–≥</button>\n        <button id=\"optQuickNote\">üóíÔ∏è –®–≤–∏–¥–∫–∞ –Ω–æ—Ç–∞—Ç–∫–∞</button>\n        <button id=\"optAssign\">üë§ –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–≥–æ</button>\n        <button id=\"optArchive\">üóÉÔ∏è –ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏</button>\n        <button id=\"optRestore\">‚ôªÔ∏è –í—ñ–¥–Ω–æ–≤–∏—Ç–∏</button>\n      </div>`;\n    formSection.insertBefore(card, formSection.querySelector('form'));\n\n    const toast = (txt)=>{ const t=document.getElementById('toast'); if(!t)return; t.textContent=txt; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 3000); };\n\n    // minimal behaviors\n    document.getElementById('optCreateLead')?.addEventListener('click', ()=>{\n      document.getElementById('name')?.focus();\n      toast('–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏¬ª');\n    });\n    document.getElementById('optFindLead')?.addEventListener('click', ()=>{\n      document.getElementById('searchInput')?.focus();\n      toast('–í–≤–µ–¥—ñ—Ç—å –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç');\n    });\n    document.getElementById('optBulkStatus')?.addEventListener('click', ()=>{\n      document.getElementById('bulkInProgressBtn')?.click();\n    });\n    document.getElementById('optDetectDup')?.addEventListener('click', ()=>{\n      // naive duplicate detection by phone/email\n      try{\n        const leads = JSON.parse(localStorage.getItem('leads')||'[]');\n        const seen = new Set(); const dups = [];\n        leads.forEach(l=>{\n          const key = (l.phone||'')+'|'+(l.email||'');\n          if (seen.has(key)) dups.push(l);\n          else seen.add(key);\n        });\n        toast(dups.length ? ('–ó–Ω–∞–π–¥–µ–Ω–æ –º–æ–∂–ª–∏–≤–∏—Ö –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤: '+dups.length) : '–î—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');\n      }catch(e){}\n    });\n    document.getElementById('optMarkPriority')?.addEventListener('click', ()=>toast('–í–∏–¥—ñ–ª—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω—ñ, –ø–æ—Ç—ñ–º —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å –º–∞—Å–æ–≤–∏–º–∏ –¥—ñ—è–º–∏'));\n    document.getElementById('optAddTag')?.addEventListener('click', ()=>{\n      const tag = prompt('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥, —è–∫–∏–π –¥–æ–¥–∞—Ç–∏ –¥–æ –≤–∏–¥—ñ–ª–µ–Ω–∏—Ö:'); if(!tag) return;\n      try{\n        let leads = JSON.parse(localStorage.getItem('leads')||'[]');\n        document.querySelectorAll('#leadsTable tbody .sel:checked').forEach(cb=>{\n          const id = Number(cb.dataset.id); const i = leads.findIndex(l=>l.id===id); if(i>-1) { leads[i].tags = ((leads[i].tags||'')+','+tag).replace(/^,|,,/g,','); }\n        });\n        localStorage.setItem('leads', JSON.stringify(leads));\n        toast('–¢–µ–≥–∏ –¥–æ–¥–∞–Ω–æ');\n      }catch(e){}\n    });\n    document.getElementById('optQuickNote')?.addEventListener('click', ()=>{\n      const note = prompt('–í–≤–µ–¥—ñ—Ç—å —à–≤–∏–¥–∫—É –Ω–æ—Ç–∞—Ç–∫—É –¥–ª—è –≤–∏–¥—ñ–ª–µ–Ω–∏—Ö:');\n      if(!note) return;\n      try{\n        let leads = JSON.parse(localStorage.getItem('leads')||'[]');\n        document.querySelectorAll('#leadsTable tbody .sel:checked').forEach(cb=>{\n          const id = Number(cb.dataset.id); const i = leads.findIndex(l=>l.id===id); if(i>-1) { leads[i].comment = (leads[i].comment? leads[i].comment+' | ': '') + note; }\n        });\n        localStorage.setItem('leads', JSON.stringify(leads));\n        toast('–ù–æ—Ç–∞—Ç–∫—É –¥–æ–¥–∞–Ω–æ');\n      }catch(e){}\n    });\n    document.getElementById('optAssign')?.addEventListener('click', ()=>{\n      const who = prompt('–ö–æ–º—É –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ (—ñ–º º—è/—ñ–Ω—ñ—Ü—ñ–∞–ª–∏)?'); if(!who) return;\n      toast('–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–æ: '+who);\n    });\n    document.getElementById('optArchive')?.addEventListener('click', ()=>toast('–ê—Ä—Ö—ñ–≤–∞—Ü—ñ—è ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø (–¥–ª—è –¥–µ–º–æ)'));\n    document.getElementById('optRestore')?.addEventListener('click', ()=>toast('–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø (–¥–ª—è –¥–µ–º–æ)'));\n  }\n\n  // ---- 2) Remove unnecessary options: hide Export CSV (and import button for —á–∏—Å—Ç–æ—Ç–∞ UX)\n  (function(){\n    const ex = document.getElementById('exportCsvBtn'); if (ex) ex.remove();\n    const imBtn = document.getElementById('importCsvBtn'); if (imBtn) imBtn.remove();\n    const imInput = document.getElementById('importCsvInput'); if (imInput) imInput.remove();\n  })();\n\n  // ---- 3) Training mode: button in Settings that launches guided steps on the form\n  function ensureTraining(){\n    // add button to settings header area (inside settingsSection)\n    const settings = document.getElementById('settingsSection');\n    if (!settings) return;\n    if (!document.getElementById('startTrainingBtn')) {\n      const btn = document.createElement('button');\n      btn.id = 'startTrainingBtn'; btn.textContent = '–ù–∞–≤—á–∞–Ω–Ω—è (–∫—É—Ä—Å)';\n      btn.style.margin = '8px 0';\n      settings.querySelector('.grid')?.prepend(btn);\n      btn.addEventListener('click', ()=>{\n        gotoSection('formSection');\n        startCoaching();\n      });\n    }\n\n    // overlay elements\n    if (!document.getElementById('coachOverlay')) {\n      const ov = document.createElement('div'); ov.id = 'coachOverlay';\n      const hl = document.createElement('div'); hl.id = 'coachHighlight';\n      const tt = document.createElement('div'); tt.id = 'coachTooltip';\n      ov.appendChild(hl); ov.appendChild(tt);\n      document.body.appendChild(ov);\n    }\n\n    const steps = [\n      { sel:'#name', title:'–ö—Ä–æ–∫ 1: –Ü–º º—è', text:'–í–≤–µ–¥—ñ—Ç—å —ñ–º º—è –∫–ª—ñ—î–Ω—Ç–∞. –ù–∞–ø—Ä., ¬´–ú–∞—Ä—ñ—è¬ª.', place:'bottom' },\n      { sel:'#phone', title:'–ö—Ä–æ–∫ 2: –¢–µ–ª–µ—Ñ–æ–Ω', text:'–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —É –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ.', place:'bottom' },\n      { sel:'#email', title:'–ö—Ä–æ–∫ 3: Email', text:'–Ø–∫—â–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –Ω–µ–º–∞ ‚Äî –≤–≤–µ–¥—ñ—Ç—å email.', place:'bottom' },\n      { sel:'#tags', title:'–ö—Ä–æ–∫ 4: –¢–µ–≥–∏', text:'–î–æ–¥–∞–π—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∫–æ–º—É: facebook, –≥–∞—Ä—è—á–∏–π‚Ä¶', place:'bottom' },\n      { sel:'#comment', title:'–ö—Ä–æ–∫ 5: –ö–æ–º–µ–Ω—Ç–∞—Ä', text:'–û–ø–∏—à—ñ—Ç—å –¥–µ—Ç–∞–ª—ñ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞.', place:'right' },\n      { sel:'#status', title:'–ö—Ä–æ–∫ 6: –°—Ç–∞—Ç—É—Å', text:'–û–±–µ—Ä—ñ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å –ª—ñ–¥–∞.', place:'right' },\n      { sel:'#leadForm button[type=\\\"submit\\\"]', title:'–ö—Ä–æ–∫ 7: –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏', text:'–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏¬ª, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ –ª—ñ–¥.', place:'top' },\n      { sel:'#searchInput', title:'–ö—Ä–æ–∫ 8: –ü–æ—à—É–∫', text:'–®—É–∫–∞–π—Ç–µ –ø–æ —ñ–º–µ–Ω—ñ, —Ç–µ–ª–µ—Ñ–æ–Ω—É, —Ç–µ–≥–∞—Ö.', place:'bottom' },\n      { sel:'#bulkInProgressBtn', title:'–ö—Ä–æ–∫ 9: –ú–∞—Å–æ–≤—ñ –¥—ñ—ó', text:'–í–∏–¥—ñ–ª—ñ—Ç—å –ª—ñ–¥–∏ –π –∑–∞–¥–∞–π—Ç–µ ¬´–í –æ–±—Ä–æ–±—Ü—ñ¬ª.', place:'left' },\n      { sel:'#themeToggleBtn', title:'–ö—Ä–æ–∫ 10: –¢–µ–º–∞', text:'–ü–µ—Ä–µ–º–∏–∫–∞–π—Ç–µ —Å–≤—ñ—Ç–ª—É/—Ç–µ–º–Ω—É —Ç–µ–º—É.', place:'bottom' }\n    ];\n\n    function posEl(el){\n      const r = el.getBoundingClientRect();\n      const pad = 6;\n      const x = Math.max(8, r.left - pad), y = Math.max(8, r.top - pad);\n      const w = Math.min(window.innerWidth-16, r.width + pad*2);\n      const h = Math.min(window.innerHeight-16, r.height + pad*2);\n      return {x, y, w, h};\n    }\n\n    let i = 0;\n    function renderStep(){\n      const ov = document.getElementById('coachOverlay'); const hl = document.getElementById('coachHighlight'); const tt = document.getElementById('coachTooltip');\n      const st = steps[i]; const el = document.querySelector(st.sel);\n      if (!el){ i++; if (i>=steps.length){ finish(); return;} return renderStep(); }\n      const p = posEl(el);\n      ov.style.display='block';\n      hl.style.left = p.x+'px'; hl.style.top = p.y+'px'; hl.style.width = p.w+'px'; hl.style.height = p.h+'px';\n      let tx = p.x, ty = p.y + p.h + 10;\n      if (st.place==='top') ty = Math.max(10, p.y - 100);\n      if (st.place==='left') tx = Math.max(10, p.x - 380);\n      if (st.place==='right') tx = Math.min(window.innerWidth - 370, p.x + p.w + 10);\n      tt.style.left = tx+'px'; tt.style.top = ty+'px';\n      tt.innerHTML = `<h4>${st.title}</h4><p>${st.text}</p><div class=\"row\">\n        <button id=\"coachPrev\"${i===0?' disabled':''}>–ù–∞–∑–∞–¥</button>\n        <button id=\"coachNext\">${i===steps.length-1?'–ó–∞–≤–µ—Ä—à–∏—Ç–∏':'–î–∞–ª—ñ'}</button>\n        <button id=\"coachSkip\" class=\"btn-secondary\">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>\n      </div>`;\n      document.getElementById('coachPrev').onclick = ()=>{ if (i>0){ i--; renderStep(); } };\n      document.getElementById('coachNext').onclick = ()=>{ if (i<steps.length-1){ i++; renderStep(); } else { finish(); } };\n      document.getElementById('coachSkip').onclick = finish;\n    }\n\n    function finish(){\n      const ov = document.getElementById('coachOverlay');\n      if (ov) ov.style.display='none';\n      i = 0;\n      // thanks\n      const t = document.getElementById('toast'); if (t){ t.textContent='–ù–∞–≤—á–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ'; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 2500); }\n    }\n\n    window.startCoaching = function(){ i=0; renderStep(); };\n  }\n\n  // ---- 4) Make sure version label stays visible and footer exists\n  function ensureFooter(){\n    if (!document.getElementById('nikFooter')){\n      const f = document.createElement('div');\n      f.id = 'nikFooter'; f.innerHTML = '<span class=\"badge\">Powered By <b>NikolosBond</b> ¬∑ Developer</span>';\n      document.body.appendChild(f);\n    }\n  }\n\n  // ---- 5) Light tweaks (keep theme if already chosen)\n  (function(){\n    // nothing here; CSS patch already adjusts visuals\n  })();\n\n  // Execute\n  try{\n    ensureCrmOptions();\n    ensureTraining();\n    ensureFooter();\n    // Ensure we're on form section so user sees changes\n    // gotoSection('formSection');\n  }catch(e){ console.warn('Patch error', e) }\n})();\n"}},{"version":"1.6.0","patch":{"cssVars":{},"css":"\n/* === v1.6.0 UI Enhancements === */\n.token-wrap{display:flex;flex-wrap:wrap;gap:6px;align-items:center;background:var(--input);border:1px solid #262c4d;border-radius:10px;padding:6px 8px}\n[data-theme=\"light\"] .token-wrap{border-color:#d8def4}\n.token{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;background:#1a2140;border:1px solid #2b3360;color:#cfe2ff;font-size:12px}\n.token .x{cursor:pointer;opacity:.8}\n[data-theme=\"light\"] .token{background:#eef2ff;border-color:#d8def4;color:#2a335a}\n.token-input{border:0;outline:0;background:transparent;color:var(--text);min-width:120px;padding:6px 4px}\n.tag-suggest{position:absolute;z-index:5; background:var(--card); border:1px solid var(--border); border-radius:8px; padding:6px; box-shadow:0 8px 30px rgba(0,0,0,.25)}\n.tag-suggest button{display:block;width:100%;text-align:left;margin:2px 0}\n.customize-bar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}\n.grid-draggable{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}\n.widget{grid-column:span 6;background:rgba(22,27,46,.82);border:1px solid var(--border);border-radius:14px;padding:12px;cursor:move}\n[data-theme=\"light\"] .widget{background:#fff;box-shadow:0 8px 26px rgba(34,40,70,.08)}\n.widget.dragging{opacity:.6}\n.edit-modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}\n.edit-card{width:min(560px,92vw);background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}\n.edit-card h3{margin:0 0 10px;color:#dbe1ff}\n.stats-grid{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:12px}\n@media(max-width:720px){.widget{grid-column:span 12}.stats-grid{grid-template-columns:1fr}}\n.update-manager{margin-top:8px;border:1px dashed var(--border);border-radius:10px;padding:10px}\n.tree ul{list-style:none;padding-left:14px}\n.tree li{margin:2px 0}\n.footer-nik{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}\n","title":"MilaWEBOS CRM (v1.6.0)","js":"\n(function(){\n  const $ = s=>document.querySelector(s);\n  const $$ = s=>Array.from(document.querySelectorAll(s));\n  const toast=(t)=>{const el=$('#toast'); if(!el) return; el.textContent=t; el.classList.remove('hidden'); setTimeout(()=>el.classList.add('hidden'),3000);};\n\n  // --- Version badge + meta\n  function setVersion(v){\n    const meta=document.querySelector('meta[name=\"app-version\"]'); if(meta) meta.content=v;\n    const pill=$('#currentVersion'); if(pill) pill.textContent='v'+v;\n  }\n\n  // --- Persist patch list (shared with app)\n  function getApplied(){ try{return JSON.parse(localStorage.getItem('appliedPatches')||'[]');}catch{return[]} }\n  function addApplied(v,patch){ const arr=getApplied(); arr.push({version:v,patch}); localStorage.setItem('appliedPatches', JSON.stringify(arr)); }\n\n  // ===== Tags: tokens + history + Enter to add =====\n  (function enhanceTags(){\n    const input = $('#tags'); if(!input) return;\n    // hide original and add token UI\n    input.style.display='none';\n    const wrap=document.createElement('div'); wrap.className='token-wrap';\n    const tokenInput=document.createElement('input'); tokenInput.className='token-input'; tokenInput.placeholder='–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥ —ñ Enter';\n    input.parentElement.insertBefore(wrap,input); wrap.appendChild(tokenInput);\n    // preload tokens from input value\n    const startTags=(input.value||'').split(',').map(s=>s.trim()).filter(Boolean);\n    const histKey='tagHistory'; let history=new Set(JSON.parse(localStorage.getItem(histKey)||'[]'));\n    function syncInput(){ input.value=$$('.token .txt').map(el=>el.textContent).join(','); }\n    function addToken(t){\n      if(!t) return; if($$('.token .txt').some(el=>el.textContent.toLowerCase()===t.toLowerCase())) return;\n      const tok=document.createElement('span'); tok.className='token';\n      tok.innerHTML='<span class=\"txt\"></span><span class=\"x\">‚úï</span>';\n      tok.querySelector('.txt').textContent=t; tok.querySelector('.x').onclick=()=>{ tok.remove(); syncInput(); };\n      wrap.insertBefore(tok, tokenInput); history.add(t); localStorage.setItem(histKey, JSON.stringify(Array.from(history))); syncInput();\n    }\n    startTags.forEach(addToken);\n    tokenInput.addEventListener('keydown',e=>{\n      if(e.key==='Enter'){ e.preventDefault(); const t=tokenInput.value.trim(); if(t){ addToken(t); tokenInput.value=''; } }\n      if(e.key==='Backspace' && !tokenInput.value){ const last=$$('.token').pop(); if(last){ last.remove(); syncInput(); } }\n    });\n    // suggestions\n    let sugg;\n    tokenInput.addEventListener('input', ()=>{\n      const q=tokenInput.value.toLowerCase().trim();\n      if(sugg) sugg.remove();\n      if(!q) return;\n      const items=Array.from(history).filter(t=>t.toLowerCase().includes(q)).slice(0,5);\n      if(!items.length) return;\n      sugg=document.createElement('div'); sugg.className='tag-suggest';\n      items.forEach(t=>{ const b=document.createElement('button'); b.type='button'; b.textContent=t; b.onclick=()=>{ addToken(t); tokenInput.value=''; sugg.remove(); }; sugg.appendChild(b); });\n      const r=tokenInput.getBoundingClientRect(); sugg.style.left=r.left+'px'; sugg.style.top=(r.bottom+4)+'px'; document.body.appendChild(sugg);\n    });\n    document.addEventListener('click',e=>{ if(sugg && !sugg.contains(e.target) && e.target!==tokenInput){ sugg.remove(); } });\n  })();\n\n  // ===== Lead edit modal =====\n  (function leadEdit(){\n    if($('#editLeadModal')) return;\n    const modal=document.createElement('div'); modal.className='edit-modal'; modal.id='editLeadModal';\n    modal.innerHTML=`<div class=\"edit-card\">\n      <h3>–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ª—ñ–¥–∞</h3>\n      <div class=\"row\">\n        <div><label>–Ü–º º—è</label><input id=\"edName\" type=\"text\"></div>\n        <div><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id=\"edPhone\" type=\"text\"></div>\n      </div>\n      <div class=\"row\">\n        <div><label>Email</label><input id=\"edEmail\" type=\"email\"></div>\n        <div><label>–°—Ç–∞—Ç—É—Å</label>\n          <select id=\"edStatus\"><option>–ù–æ–≤–∏–π</option><option>–í –æ–±—Ä–æ–±—Ü—ñ</option><option>–ó–∞–∫—Ä–∏—Ç–∏–π</option><option>–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π</option></select>\n        </div>\n      </div>\n      <div><label>–¢–µ–≥–∏</label><input id=\"edTags\" type=\"text\"></div>\n      <div><label>–ö–æ–º–µ–Ω—Ç–∞—Ä</label><textarea id=\"edComment\"></textarea></div>\n      <div style=\"display:flex; gap:8px; justify-content:flex-end; margin-top:10px\">\n        <button id=\"edCancel\">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>\n        <button id=\"edSave\" class=\"btn-secondary\">–ó–±–µ—Ä–µ–≥—Ç–∏</button>\n      </div>\n    </div>`;\n    document.body.appendChild(modal);\n    const close=()=>modal.style.display='none';\n    $('#edCancel').onclick=close;\n\n    function openFor(id, data){\n      modal.style.display='flex'; modal.dataset.id=id;\n      $('#edName').value=data.name||''; $('#edPhone').value=data.phone||''; $('#edEmail').value=data.email||'';\n      $('#edStatus').value=data.status||'–ù–æ–≤–∏–π'; $('#edTags').value=data.tags||''; $('#edComment').value=data.comment||'';\n    }\n    async function save(){\n      const id=Number(modal.dataset.id); let leads=JSON.parse(localStorage.getItem('leads')||'[]');\n      const i=leads.findIndex(l=>l.id===id); if(i<0){ close(); return; }\n      leads[i]=Object.assign({}, leads[i], { name:$('#edName').value.trim(), phone:$('#edPhone').value.trim(), email:$('#edEmail').value.trim(), status:$('#edStatus').value, tags:$('#edTags').value.trim(), comment:$('#edComment').value.trim() });\n      localStorage.setItem('leads', JSON.stringify(leads));\n      close(); toast('–ó–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ');\n      // re-render tables if exist\n      try{\n        // Trigger a simple refresh by dispatching a change on filter\n        $('#filterStatus')?.dispatchEvent(new Event('change'));\n      }catch(e){}\n    }\n    $('#edSave').onclick=save;\n\n    // inject Edit buttons into main table (observe mutations)\n    ['#leadsTable tbody', '#leadsTable2 tbody'].forEach(sel=>{\n      const tb=$(sel); if(!tb) return;\n      const observer=new MutationObserver(()=>{\n        $$(sel+' tr').forEach(tr=>{\n          if(tr.dataset.edited) return;\n          tr.dataset.edited=1;\n          // find id from first/second cell depending on table\n          const cells=tr.querySelectorAll('td');\n          let idCellIndex = sel.includes('leadsTable2') ? 0 : 1;\n          const idText=cells[idCellIndex]?.textContent?.trim();\n          const id=Number(idText);\n          if(!isFinite(id)) return;\n          const actionsCell = tr.lastElementChild;\n          const btn=document.createElement('button'); btn.className='pill'; btn.textContent='‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏';\n          btn.onclick=()=>{\n            const leads=JSON.parse(localStorage.getItem('leads')||'[]');\n            const item=leads.find(l=>l.id===id); if(!item) return;\n            openFor(id, item);\n          };\n          if(actionsCell) actionsCell.appendChild(btn);\n        });\n      });\n      observer.observe(tb, {childList:true, subtree:true});\n    });\n  })();\n\n  // ===== Stats dashboard =====\n  (function stats(){\n    const adv=$('#advancedFeaturesSection'); if(!adv) return;\n    if($('#statsBlock')) return;\n    const block=document.createElement('div'); block.className='card'; block.id='statsBlock';\n    block.innerHTML=`<h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>\n      <div class=\"stats-grid\">\n        <div class=\"card\"><canvas id=\"chartStatusPie\"></canvas></div>\n        <div class=\"card\"><canvas id=\"chartByDay\"></canvas></div>\n      </div>`;\n    adv.querySelector('.grid')?.appendChild(block);\n    setTimeout(()=>render(), 200);\n    function render(){\n      const leads=JSON.parse(localStorage.getItem('leads')||'[]');\n      // pie by status\n      const statuses=['–ù–æ–≤–∏–π','–í –æ–±—Ä–æ–±—Ü—ñ','–ó–∞–∫—Ä–∏—Ç–∏–π','–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π'];\n      const pie=statuses.map(s=>leads.filter(l=>l.status===s).length);\n      const c1=$('#chartStatusPie'); if(c1){ new Chart(c1,{type:'doughnut', data:{labels:statuses,datasets:[{data:pie} ]}, options:{responsive:true}}); }\n      // by day\n      const byDay={};\n      leads.forEach(l=>{ const d=(l.date||'').split(',')[0].trim(); if(!d) return; byDay[d]=(byDay[d]||0)+1; });\n      const days=Object.keys(byDay).sort((a,b)=>new Date(a.split('.').reverse().join('-'))-new Date(b.split('.').reverse().join('-')));\n      const c2=$('#chartByDay'); if(c2){ new Chart(c2,{type:'line', data:{labels:days, datasets:[{label:'–õ—ñ–¥–∏/–¥–µ–Ω—å', data:days.map(d=>byDay[d])}]}, options:{responsive:true}}); }\n    }\n  })();\n\n  // ===== Layout personalization (drag & drop \"puzzle\") =====\n  (function personalize(){\n    if($('#customizeBar')) return;\n    const formSec=$('#formSection'); if(!formSec) return;\n    const bar=document.createElement('div'); bar.className='customize-bar'; bar.id='customizeBar';\n    bar.innerHTML=`<button id=\"startCustomize\">üîß –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å</button><button id=\"saveLayout\" class=\"btn-secondary\" disabled>–ó–±–µ—Ä–µ–≥—Ç–∏ –º–∞–∫–µ—Ç</button>`;\n    formSec.prepend(bar);\n    const layoutKey='layoutConfig';\n    let dragSrc=null;\n    function makeDraggable(){\n      $$('.widget').forEach(w=>{ w.setAttribute('draggable','true');\n        w.addEventListener('dragstart',e=>{dragSrc=w; w.classList.add('dragging'); e.dataTransfer.effectAllowed='move';});\n        w.addEventListener('dragend',()=>w.classList.remove('dragging'));\n        w.addEventListener('dragover',e=>{ e.preventDefault(); });\n        w.addEventListener('drop',e=>{ e.preventDefault(); if(!dragSrc || dragSrc===w) return;\n          const parent=w.parentNode; const nodes=[...parent.children];\n          const srcIndex=nodes.indexOf(dragSrc); const dstIndex=nodes.indexOf(w);\n          if(srcIndex<dstIndex) parent.insertBefore(dragSrc, w.nextSibling); else parent.insertBefore(dragSrc, w);\n        });\n      });\n    }\n    $('#startCustomize').onclick=()=>{\n      // wrap selected cards into grid-draggable\n      const container=document.createElement('div'); container.className='grid-draggable'; container.id='gridDrag';\n      const cards = [$('#crmOptionsCard'), $('#leadForm').closest('.section'), $('.table-wrap.card'), $('.chart-box').closest('.card')].filter(Boolean);\n      // choose safe widgets\n      const uniq=[]; cards.forEach(c=>{ if(c && !uniq.includes(c)) uniq.push(c) });\n      uniq.forEach(c=>{ const w=document.createElement('div'); w.className='widget'; w.appendChild(c); container.appendChild(w); });\n      formSec.appendChild(container);\n      $('#saveLayout').disabled=false;\n      makeDraggable();\n    };\n    $('#saveLayout').onclick=()=>{\n      const order=$$('#gridDrag .widget').map(w=> w.innerText.slice(0,40));\n      localStorage.setItem(layoutKey, JSON.stringify(order));\n      toast('–ú–∞–∫–µ—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ');\n    };\n  })();\n\n  // ===== Backup & Restore =====\n  (function backup(){\n    const settings=$('#settingsSection'); if(!settings) return;\n    if($('#backupBar')) return;\n    const bar=document.createElement('div'); bar.className='card'; bar.id='backupBar';\n    bar.innerHTML=`<h2>–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è</h2>\n      <button id=\"backupBtn\">–ó—Ä–æ–±–∏—Ç–∏ –±–µ–∫–∞–ø</button>\n      <input id=\"restoreFile\" type=\"file\" accept=\".json\" class=\"hidden\">\n      <button id=\"restoreBtn\" class=\"btn-secondary\">–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ —Ñ–∞–π–ª—É</button>\n      <div class=\"footer-nik\">Powered By <b>NikolosBond</b> ¬∑ Developer</div>`;\n    settings.querySelector('.grid')?.appendChild(bar);\n    $('#backupBtn').onclick=()=>{\n      const data={\n        leads: JSON.parse(localStorage.getItem('leads')||'[]'),\n        theme: localStorage.getItem('theme'),\n        appliedPatches: JSON.parse(localStorage.getItem('appliedPatches')||'[]'),\n        tagHistory: JSON.parse(localStorage.getItem('tagHistory')||'[]')\n      };\n      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});\n      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='milawebos-backup.json'; a.click();\n    };\n    $('#restoreBtn').onclick=()=>$('#restoreFile').click();\n    $('#restoreFile').addEventListener('change', async ()=>{\n      const f=$('#restoreFile').files[0]; if(!f) return;\n      const text=await f.text();\n      try{\n        const data=JSON.parse(text);\n        if(data.leads) localStorage.setItem('leads', JSON.stringify(data.leads));\n        if(data.theme) localStorage.setItem('theme', data.theme);\n        if(data.appliedPatches) localStorage.setItem('appliedPatches', JSON.stringify(data.appliedPatches));\n        if(data.tagHistory) localStorage.setItem('tagHistory', JSON.stringify(data.tagHistory));\n        toast('–î–∞–Ω—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ'); location.reload();\n      }catch(e){ toast('–§–∞–π–ª –ø–æ—à–∫–æ–¥–∂–µ–Ω–æ'); }\n    });\n  })();\n\n  // ===== Update Manager (folder tree, grouped) =====\n  ;(function updateManager(){\n    const settings=$('#settingsSection'); if(!settings || $('#updateManager')) return;\n    const wrap=document.createElement('div'); wrap.className='update-manager'; wrap.id='updateManager';\n    wrap.innerHTML=`<h3>–ú–µ–Ω–µ–¥–∂–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω—å (.mmur)</h3>\n      <div style=\"display:flex; gap:8px; flex-wrap:wrap\">\n        <button id=\"umPick\">–í–∏–±—Ä–∞—Ç–∏ –ø–∞–ø–∫—É</button>\n        <button id=\"umScan\">–°–∫–∞–Ω—É–≤–∞—Ç–∏</button>\n        <button id=\"umInstall\" class=\"btn-secondary\" disabled>–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω–µ</button>\n      </div>\n      <div class=\"tree\" id=\"umTree\"></div>`;\n    settings.querySelector('.grid')?.prepend(wrap);\n    let folder=null, selected=null;\n\n    async function* walk(dirHandle, path=''){\n      for await (const entry of dirHandle.values()){\n        if(entry.kind==='directory'){ yield {dir:true, name:entry.name, path:path+entry.name+'/'}; yield* walk(entry, path+entry.name+'/'); }\n        else if(entry.kind==='file' && entry.name.toLowerCase().endsWith('.mmur')){\n          yield {file:true, name:entry.name, path:path+entry.name, handle:entry};\n        }\n      }\n    }\n    async function scan(){\n      if(!folder){ toast('–û–±–µ—Ä—ñ—Ç—å –ø–∞–ø–∫—É'); return; }\n      const root={name:'root', children:{}};\n      for await (const it of walk(folder,'')){\n        const parts=it.path.split('/').filter(Boolean);\n        let node=root;\n        for(let i=0;i<parts.length;i++){\n          const isFile = (i===parts.length-1 && it.file);\n          const key=parts[i];\n          if(isFile){\n            node.children[key]={file:true, handle:it.handle, name:key};\n          }else{\n            node.children[key]=node.children[key]||{name:key, children:{}};\n            node=node.children[key];\n          }\n        }\n      }\n      const tree=$('#umTree'); tree.innerHTML='';\n      function render(node, ul){\n        Object.keys(node.children||{}).sort().forEach(k=>{\n          const n=node.children[k];\n          const li=document.createElement('li');\n          if(n.file){\n            const btn=document.createElement('button'); btn.textContent=k;\n            btn.onclick=async ()=>{\n              selected = n;\n              const file=await n.handle.getFile(); const text=await file.text();\n              try{\n                const mf=JSON.parse(text);\n                const info = (mf && mf.version)? ('v'+mf.version+' ‚Äî '+(mf.note||'')) : '–Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π mmur';\n                toast('–í–∏–±—Ä–∞–Ω–æ: '+k+' ¬∑ '+info);\n                $('#umInstall').disabled=false;\n              }catch{ toast('–§–∞–π–ª –ø–æ—à–∫–æ–¥–∂–µ–Ω–æ'); $('#umInstall').disabled=true; }\n            };\n            li.appendChild(btn);\n          } else {\n            li.innerHTML='<b>'+k+'</b>';\n            const childUl=document.createElement('ul'); render(n, childUl); li.appendChild(childUl);\n          }\n          ul.appendChild(li);\n        });\n      }\n      const ul=document.createElement('ul'); render(root, ul); tree.appendChild(ul);\n    }\n\n    $('#umPick').onclick=async()=>{ try{ folder=await window.showDirectoryPicker({id:'mmur-updates-nested'}); toast('–ü–∞–ø–∫—É –≤–∏–±—Ä–∞–Ω–æ'); }catch(e){} };\n    $('#umScan').onclick=scan;\n    $('#umInstall').onclick=async()=>{\n      if(!selected) return;\n      const file=await selected.handle.getFile(); const text=await file.text();\n      try{\n        const mf=JSON.parse(text);\n        if(mf.patch){\n          // apply patch persistently\n          if(mf.patch.cssVars){ Object.entries(mf.patch.cssVars).forEach(([k,v])=>document.documentElement.style.setProperty(k,v)); }\n          if(mf.patch.css){ const s=document.createElement('style'); s.textContent=mf.patch.css; document.head.appendChild(s); }\n          if(mf.patch.title){ const t=$('#appTitle'); if(t) t.textContent=mf.patch.title; document.title=(mf.patch.title||'MilaWEBOS')+' ‚Äî MilaWEBOS'; }\n          if(mf.patch.js){ try{ (new Function(mf.patch.js))(); }catch(e){} }\n          setVersion(mf.version||'1.x');\n          addApplied(mf.version||'1.x', mf.patch);\n          toast('–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ '+(mf.version||''));\n        } else { toast('–£ —Ñ–∞–π–ª—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π patch'); }\n      }catch(e){ toast('–ü–æ–º–∏–ª–∫–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è'); }\n    }\n  })();\n\n  // add footer credit if not present\n  (function footer(){\n    if(!document.getElementById('nikFooter')){\n      const f=document.createElement('div'); f.id='nikFooter'; f.className='footer-nik';\n      f.innerHTML='Powered By <b>NikolosBond</b> ¬∑ Developer';\n      document.body.appendChild(f);\n    }\n  })();\n\n  // Set new version\n  setVersion('1.6.0');\n})();"}}]}</script>

  <script>
    // ---- Helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = (txt)=>{ const t=$('#toast'); t.textContent = txt; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 3500); }

    // ---- Particles
    particlesJS('particles-js',{particles:{number:{value:45,density:{enable:true,value_area:800}},color:{value:['#6ea8ff','#a78bfa']},shape:{type:'circle'},opacity:{value:.25},size:{value:3,random:true},line_linked:{enable:true,distance:150,color:'#2b3360',opacity:.25,width:1},move:{enable:true,speed:2}},interactivity:{events:{onhover:{enable:true,mode:'grab'},onclick:{enable:true,mode:'push'}},modes:{grab:{distance:140,line_linked:{opacity:.6}}}},retina_detect:true});

    document.addEventListener('DOMContentLoaded', () => {
      const versionMeta = document.querySelector('meta[name="app-version"]');
      const versionPill = $('#currentVersion');
      const appTitleEl = $('#appTitle');
      function setVersion(v){ if(versionMeta) versionMeta.content=v; if(versionPill) versionPill.textContent='v'+v; }

      // THEME
      const themeBtn = $('#themeToggleBtn');
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      themeBtn.addEventListener('click', ()=>{
        const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      });

      // DATA
      let leads = JSON.parse(localStorage.getItem('leads') || '[]');
      let leadsChartInstance = null;
      let leadsChartInstance2 = null;

      const showSection = id => { $$('.section').forEach(s=>{s.classList.add('hidden'); s.classList.remove('active')}); const el=$( '#'+id ); el.classList.remove('hidden'); setTimeout(()=>el.classList.add('active'),10) };

      function renderLeads(tableSel){
        const term = ($('#searchInput')?.value || '').toLowerCase();
        const statusFilter = $('#filterStatus')?.value || '';
        const rowsTarget = tableSel ? tableSel : '#leadsTable tbody';
        const tbody = document.querySelector(rowsTarget); if (!tbody) return;
        tbody.innerHTML = '';
        leads.filter(l=>{
          const text = [l.name,l.phone,l.email,l.tags,l.comment].join(' ').toLowerCase();
          const okTerm = !term || text.includes(term);
          const okStatus = !statusFilter || l.status === statusFilter;
          return okTerm && okStatus;
        }).forEach(l=>{
          const tr = document.createElement('tr');
          if (rowsTarget.includes('leadsTable tbody')) {
            tr.innerHTML = `<td><input type="checkbox" class="sel" data-id="${l.id}"></td>
                            <td>${l.id}</td><td>${l.name||''}</td><td>${l.phone||''}</td><td>${l.email||''}</td>
                            <td>${l.comment||''}</td><td>${l.status||''}</td><td>${l.tags||''}</td><td>${l.date||''}</td>
                            <td>${l.score??''}</td>
                            <td><button class="pill del" data-id="${l.id}">üóëÔ∏è</button></td>`;
          } else {
            tr.innerHTML = `<td>${l.id}</td><td>${l.name||''}</td><td>${l.phone||''}</td><td>${l.email||''}</td>
                            <td>${l.comment||''}</td><td>${l.status||''}</td><td>${l.tags||''}</td><td>${l.date||''}</td>
                            <td>${l.score??''}</td>`;
          }
          tbody.appendChild(tr);
        });
        // actions
        tbody.querySelectorAll('button.del').forEach(btn=>btn.addEventListener('click',()=>{
          const id = Number(btn.dataset.id); leads = leads.filter(l=>l.id!==id);
          localStorage.setItem('leads', JSON.stringify(leads)); renderLeads(); renderChart('#leadsChart'); renderLeads('#leadsTable2 tbody'); renderChart('#leadsChart2');
        }));
      }

      function renderChart(canvasSel){
        const ctx = $(canvasSel || '#leadsChart'); if(!ctx) return;
        const statuses = ['–ù–æ–≤–∏–π','–í –æ–±—Ä–æ–±—Ü—ñ','–ó–∞–∫—Ä–∏—Ç–∏–π','–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π'];
        const data = statuses.map(s => leads.filter(l => l.status === s).length);
        const instRef = canvasSel && canvasSel.includes('2') ? '2' : '';
        const prev = instRef==='2' ? leadsChartInstance2 : leadsChartInstance;
        if (prev) prev.destroy();
        const inst = new Chart(ctx, { type:'bar', data:{ labels:statuses, datasets:[{label:'–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª—ñ–¥—ñ–≤', data}] }, options:{responsive:true, maintainAspectRatio:false} });
        if (instRef==='2') leadsChartInstance2 = inst; else leadsChartInstance = inst;
      }

      // FORM
      $('#leadForm').addEventListener('submit', e=>{
        e.preventDefault();
        const name = $('#name').value.trim();
        const phone = $('#phone').value.trim();
        const email = $('#email').value.trim();
        const comment = $('#comment').value.trim();
        const status = $('#status').value;
        const tags = $('#tags').value.trim();
        const ok = $('#successMessage'); const err = $('#errorMessage');
        if (!phone && !email) { err.classList.remove('hidden'); ok.classList.add('hidden'); return; }
        err.classList.add('hidden');
        const date = new Date().toLocaleString('uk-UA');
        leads.push({ id: Date.now(), name, phone, email, comment, status, tags, date });
        localStorage.setItem('leads', JSON.stringify(leads));
        ok.classList.remove('hidden'); e.target.reset();
        renderLeads(); renderChart('#leadsChart'); renderLeads('#leadsTable2 tbody'); renderChart('#leadsChart2');
      });

      // toolbar actions
      $('#searchInput').addEventListener('input', ()=>renderLeads());
      $('#filterStatus').addEventListener('change', ()=>renderLeads());
      $('#exportCsvBtn').addEventListener('click', ()=>{
        const headers = ['id','name','phone','email','comment','status','tags','date','score'];
        const rows = leads.map(l=>headers.map(h=> `"${(l[h]??'').toString().replace(/"/g,'""')}"`).join(','));
        const csv = [headers.join(','), ...rows].join('\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='leads.csv'; a.click();
      });
      $('#importCsvBtn').addEventListener('click', ()=>$('#importCsvInput').click());
      $('#importCsvInput').addEventListener('change', async ()=>{
        const file = $('#importCsvInput').files[0]; if(!file) return;
        const text = await file.text(); const lines = text.split(/\r?\n/).filter(Boolean);
        const headers = lines.shift().split(',').map(h=>h.replace(/^"|"$/g,''));
        lines.forEach(line=>{
          const cols = line.match(/("([^"]|"")*"|[^,]+)/g)||[];
          const obj = {}; headers.forEach((h,i)=> obj[h] = (cols[i]||'').replace(/^"|"$/g,'').replace(/""/g,'"'));
          obj.id = Number(obj.id)||Date.now(); leads.push(obj);
        });
        localStorage.setItem('leads', JSON.stringify(leads)); renderLeads(); renderChart('#leadsChart'); renderLeads('#leadsTable2 tbody'); renderChart('#leadsChart2');
        toast('–Ü–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
      });
      $('#bulkInProgressBtn').addEventListener('click', ()=>{
        $$('#leadsTable tbody .sel:checked').forEach(cb=>{
          const id = Number(cb.dataset.id); const i = leads.findIndex(l=>l.id===id); if(i>-1) leads[i].status='–í –æ–±—Ä–æ–±—Ü—ñ';
        });
        localStorage.setItem('leads', JSON.stringify(leads)); renderLeads(); renderChart('#leadsChart'); toast('–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ');
      });
      $('#selectAll').addEventListener('change', (e)=>{
        $$('#leadsTable tbody .sel').forEach(cb=>cb.checked = e.target.checked);
      });

      // Nav
      $('#viewLeadsBtn').addEventListener('click', ()=>{ renderLeads('#leadsTable2 tbody'); renderChart('#leadsChart2'); showSection('leadsSection') });
      $('#settingsBtn').addEventListener('click', ()=>showSection('settingsSection'));
      $('#advancedFeaturesBtn').addEventListener('click', ()=>showSection('advancedFeaturesSection'));
      $('#backToFormBtn').addEventListener('click', ()=>showSection('formSection'));

      // Advanced
      $('#generateReportBtn').addEventListener('click', ()=>{
        const total = leads.length;
        const byStatus = s => leads.filter(l=>l.status===s).length;
        $('#generatedReport').innerHTML = `<pre>–í—Å—å–æ–≥–æ: ${total}
–ù–æ–≤—ñ: ${byStatus('–ù–æ–≤–∏–π')}
–í –æ–±—Ä–æ–±—Ü—ñ: ${byStatus('–í –æ–±—Ä–æ–±—Ü—ñ')}
–ó–∞–∫—Ä–∏—Ç—ñ: ${byStatus('–ó–∞–∫—Ä–∏—Ç–∏–π')}
–í—ñ–¥—Ö–∏–ª–µ–Ω—ñ: ${byStatus('–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π')}</pre>`;
      });
      $('#scheduleMeetingBtn').addEventListener('click', ()=>{
        const d = new Date().toLocaleString('uk-UA'); $('#scheduledMeeting').textContent = '–ó—É—Å—Ç—Ä—ñ—á –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω–∞ '+d;
      });
      $('#clearDataBtn').addEventListener('click', ()=>{
        if (confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ (–ª—ñ–¥–∏/—Ç–µ–º—É/–ø–∞—Ç—á—ñ)?')) {
          localStorage.clear(); location.reload();
        }
      });

      // ---- UPDATES: .mmur + persist across reload ----
      const sumBox = $('#updateSummary'); const sumMeta = $('#updateMeta'); const sumChanges = $('#updateChanges'); const sumNote = $('#updateNote'); const sumMode = $('#updateModeInfo');
      const installBtn = $('#installUpdateBtn'); const checkBtn = $('#checkUpdateBtn');
      const pickFolderBtn = $('#pickUpdateFolderBtn'); const saveAsBtn = $('#saveAsCurrentBtn');

      let updateFolderHandle = null;
      let pendingPatch = null;  // parsed manifest object
      let pendingVersion = null;

      // load previously granted folder permission (optional: not persisted here)
      async function pickFolder(){ try{ updateFolderHandle = await window.showDirectoryPicker({id:'mmur-updates'}); toast('–ü–∞–ø–∫—É –æ–Ω–æ–≤–ª–µ–Ω—å –≤–∏–±—Ä–∞–Ω–æ'); } catch(e){ console.warn(e) } }
      pickFolderBtn.addEventListener('click', pickFolder);

      async function scanForUpdates(){
        if (!updateFolderHandle) { toast('–°–ø–µ—Ä—à—É –≤–∏–±–µ—Ä—ñ—Ç—å –ø–∞–ø–∫—É –æ–Ω–æ–≤–ª–µ–Ω—å'); return null; }
        const updates = [];
        for await (const entry of updateFolderHandle.values()) {
          if (entry.kind === 'file' && entry.name.toLowerCase().endsWith('.mmur')) {
            const file = await entry.getFile(); const text = await file.text();
            try {
              const man = JSON.parse(text);
              if (man && man.type==='mila-update' && /^mmur\/v1/.test(man.format)) {
                updates.push({ name: entry.name, manifest: man, fileText: text, fileHandle: entry });
              }
            } catch(e) { console.warn('Bad mmur', entry.name, e) }
          }
        }
        if (!updates.length) { toast('–û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ'); return null; }
        // choose latest by version (simple lexicographic fallback)
        updates.sort((a,b)=> (a.manifest.version||'0').localeCompare(b.manifest.version||'0', undefined, {numeric:true}));
        return updates[updates.length-1];
      }

      async function checkUpdateNow(){
        const candidate = await scanForUpdates(); if (!candidate) return;
        const mf = candidate.manifest;
        pendingPatch = mf; pendingVersion = mf.version;
        sumChanges.innerHTML=''; sumMeta.innerHTML=''; sumNote.textContent=''; sumMode.textContent='';
        sumMeta.innerHTML = `<div>–í–µ—Ä—Å—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <span class="pill">v${mf.version}</span></div>
                             <div>–î–∞—Ç–∞: <span class="pill">${mf.date||'‚Äî'}</span></div>
                             <div>–ú—ñ–Ω. –≤–µ—Ä—Å—ñ—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É: <span class="pill">v${mf.minAppVersion||'‚Äî'}</span></div>`;
        (mf.changes||[]).forEach(c=>{ const li=document.createElement('li'); li.textContent=c; sumChanges.appendChild(li); });
        sumNote.textContent = mf.note||'';
        sumMode.innerHTML = `<div>–†–µ–∂–∏–º: <span class="pill">${mf.mode||'patch-persist'}</span></div>`;
        sumBox.classList.remove('hidden'); installBtn.disabled = false; toast('–ó–Ω–∞–π–¥–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è '+candidate.name);
      }
      checkBtn.addEventListener('click', checkUpdateNow);

      // persist applied patches in the HTML (in <script id="applied-patches">) and in localStorage
      function getAppliedPatches(){
        try { return JSON.parse(document.getElementById('applied-patches').textContent).applied || []; } catch { return []; }
      }
      function setAppliedPatches(arr){
        const el = document.getElementById('applied-patches');
        el.textContent = JSON.stringify({applied: arr});
        localStorage.setItem('appliedPatches', JSON.stringify(arr));
      }

      function applyPatch(p, newVersion){
        try{
          if (p.cssVars && typeof p.cssVars==='object'){
            const root=document.documentElement; Object.entries(p.cssVars).forEach(([k,v])=>root.style.setProperty(k,v));
          }
          if (p.css){ const s=document.createElement('style'); s.textContent=p.css; document.head.appendChild(s); }
          if (p.title){ appTitleEl.textContent=p.title; document.title=p.title+' ‚Äî MilaWEBOS'; }
          if (p.js){ try{ (new Function(p.js))(); }catch(e){ console.warn('Patch JS error', e) } }
          if (newVersion) setVersion(newVersion);
          // record
          const list = getAppliedPatches(); list.push({version:newVersion, patch:p}); setAppliedPatches(list);
          toast('–û–Ω–æ–≤–ª–µ–Ω–æ –¥–æ v'+newVersion);
        }catch(e){ console.error('Patch apply error', e); toast('–ü–æ–º–∏–ª–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–∞—Ç—á–∞'); }
      }

      // Re-apply patches on load
      try {
        const saved = JSON.parse(localStorage.getItem('appliedPatches')||'[]');
        if (saved.length) {
          saved.forEach(it=> applyPatch(it.patch));
          setVersion(versionMeta?.content || '1.1.0');
        }
      } catch {}

      installBtn.addEventListener('click', ()=>{
        if (!pendingPatch) { alert('–ù–µ–º–∞—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è'); return; }
        if ((pendingPatch.mode||'patch-persist') === 'patch-persist') {
          applyPatch(pendingPatch.patch||{}, pendingVersion||'1.x');
        } else {
          // fallback replace (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—É—Ç)
          toast('–¶–µ –Ω–µ patch-persist –æ–Ω–æ–≤–ª–µ–Ω–Ω—è');
        }
      });

      // Save as current HTML: write this document with embedded applied patches JSON so reload keeps state
      saveAsBtn.addEventListener('click', async ()=>{
        const handle = await window.showSaveFilePicker({ suggestedName: document.title.replace(/[^\w.-]+/g,'_') + '.html', types:[{description:'HTML', accept:{'text/html':['.html']}}]});
        const writable = await handle.createWritable();
        // ensure applied patches script is up to date
        const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
        await writable.write(html); await writable.close();
        toast('–§–∞–π–ª –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –π–æ–≥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É ‚Äî –ø–∞—Ç—á—ñ –∑–∞—Å—Ç–æ—Å—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.');
      });

      // Auto-scan every 10s if folder chosen
      setInterval(()=>{ if(updateFolderHandle) checkUpdateNow(); }, 10000);

      // Init
      showSection('formSection');
      renderLeads(); renderChart('#leadsChart'); renderLeads('#leadsTable2 tbody'); renderChart('#leadsChart2');
    });
  </script>


<div id="coachOverlay"><div id="coachHighlight"></div><div id="coachTooltip"></div></div><div id="nikFooter"><span class="badge">Powered By <b>NikolosBond</b> ¬∑ Developer</span></div><div class="edit-modal" id="editLeadModal"><div class="edit-card">
      <h3>–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ª—ñ–¥–∞</h3>
      <div class="row">
        <div><label>–Ü–º º—è</label><input id="edName" type="text"></div>
        <div><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="edPhone" type="text"></div>
      </div>
      <div class="row">
        <div><label>Email</label><input id="edEmail" type="email"></div>
        <div><label>–°—Ç–∞—Ç—É—Å</label>
          <select id="edStatus"><option>–ù–æ–≤–∏–π</option><option>–í –æ–±—Ä–æ–±—Ü—ñ</option><option>–ó–∞–∫—Ä–∏—Ç–∏–π</option><option>–í—ñ–¥—Ö–∏–ª–µ–Ω–∏–π</option></select>
        </div>
      </div>
      <div><label>–¢–µ–≥–∏</label><input id="edTags" type="text"></div>
      <div><label>–ö–æ–º–µ–Ω—Ç–∞—Ä</label><textarea id="edComment"></textarea></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
        <button id="edCancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button id="edSave" class="btn-secondary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
      </div>
    </div></div></body></html>